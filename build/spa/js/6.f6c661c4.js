(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{a9cc:function(t,e,a){"use strict";a("f33d")},b99f:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{attrs:{padding:""}},[a("div",{staticClass:"row justify-evenly content-start q-gutter-md"},[a("amplify-card",{staticClass:"col-5 col-grow",attrs:{cancelable:!1,title:t.$t("credits")},scopedSlots:t._u([{key:"description",fn:function(){return[a("div",{staticClass:"text-body"},[t._v(t._s(t.$t("your_credits"))+": "+t._s(t.$store.state.credits.credit))])]},proxy:!0},{key:"default",fn:function(){return[a("div",{staticClass:"text-right text-h1 text-weight-bolder",staticStyle:{opacity:"0.2"}},[a("div",[t._v(t._s(t.$store.state.credits.credit))])])]},proxy:!0}])}),a("actions"),a("transaction")],1)])},s=[],n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticClass:"col-3 col-grow items-start",staticStyle:{"min-height":"240px","min-width":"320px"},attrs:{bordered:"",flat:""}},[a("q-card-section",{staticClass:"row justify-evenly content-center q-gutter-md"},[a("amplify-button",{staticClass:"col-5 col-grow",attrs:{immediate:"",label:t.$t("transfer"),"on-click":function(){return t.showTransferDialog=!0}}}),a("amplify-button",{staticClass:"col-5 col-grow",attrs:{immediate:"",label:t.$t("receive"),"on-click":function(){return t.showReceiveDialog=!0}}})],1),a("q-separator"),a("q-card-section",{staticClass:"row justify-evenly content-center q-gutter-md"},[a("amplify-button",{staticClass:"col-5 col-grow",attrs:{label:"Transfer >> 5","on-click":t.transfer5}}),a("amplify-button",{staticClass:"col-5 col-grow",attrs:{label:"PayData >> 7","on-click":t.payData7}}),a("amplify-button",{staticClass:"col-5 col-grow",attrs:{label:"Bonus >> 99","on-click":t.bonus99}}),a("amplify-button",{staticClass:"col-5 col-grow",attrs:{label:"Set >> 100","on-click":t.set100}}),a("amplify-button",{staticClass:"col-5 col-grow",attrs:{label:"getBonus","on-click":t.getBonus}})],1),a("amplify-dialog",{attrs:{title:t.$t("transfer"),"submit-label":t.$t("transfer"),"on-submit":t.transfer,"on-clear":function(){return t.form.clearData()}},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.disable;return t._l(t.form.items,(function(e,s){return a("amplify-input",t._b({key:s,attrs:{label:t.$t(e.bound.label),readonly:i,required:"",range:"amount"===s?[0,1e3]:void 0},model:{value:e.model,callback:function(a){t.$set(e,"model",a)},expression:"item.model"}},"amplify-input",e.bound,!1))}))}}]),model:{value:t.showTransferDialog,callback:function(e){t.showTransferDialog=e},expression:"showTransferDialog"}},[a("template",{slot:"description"},[t._v("\n      "+t._s(t.$t("fill_the_receipt_code"))+"\n    ")]),a("template",{slot:"options"},[a("amplify-button",{attrs:{immediate:"",label:t.receiver}})],1)],2),a("amplify-dialog",{attrs:{title:t.$t("receive"),"submit-label":t.$t("copy"),"on-submit":t.copyCode},scopedSlots:t._u([{key:"default",fn:function(){return[a("amplify-button",{attrs:{immediate:"",label:t.$store.state.account.sub}})]},proxy:!0}]),model:{value:t.showReceiveDialog,callback:function(e){t.showReceiveDialog=e},expression:"showReceiveDialog"}},[a("template",{slot:"description"},[t._v("\n      "+t._s(t.$t("code_the_receipt_code"))+"\n    ")])],2)],1)},o=[],r=a("9523"),c=a.n(r),l=(a("5319"),a("ed08")),m=a("8e4e");class u{static _dispatch(t,e){return Object(l["getContext"])().$store.dispatch(t,e)}static setCurrentCredit(t){return this._dispatch(this.Actions.CREDIT_SET_CURRENT_CREDIT,t)}static transfer(t,e,a,i){return this._dispatch(this.Actions.CREDIT_TRANSFER,{receiver:t,amount:e,category:a,meta:i})}}c()(u,"Actions",{CREDIT_TRANSFER:"CREDIT_TRANSFER",CREDIT_INIT_DATA:"CREDIT_INIT_DATA",CREDIT_CLEAR_DATA:"CREDIT_CLEAR_DATA",CREDIT_FETCH_TRANSACTION:"CREDIT_FETCH_TRANSACTION",CREDIT_CLEAR_TRANSACTION:"CREDIT_CLEAR_TRANSACTION",CREDIT_SET_CURRENT_CREDIT:"CREDIT_SET_CURRENT_CREDIT"});class d{static showRaw(t,e){Object(l["ctx$notify"])({message:t,type:e,position:"bottom-right",timeout:5e3})}static show(t,e){const a="credit_",i=Object(l["ctx$t"])(a+t.replace(/ /g,"_"));Object(l["ctx$notify"])({message:i,type:e,position:"bottom-right",timeout:5e3})}static showPositive(t){this.show(t,"positive")}static showNegative(t){const e=!Object.keys(this.ERROR_EVENTS).includes(t);e?this.showRaw(t,"negative"):this.show(this.ERROR_EVENTS[t],"negative")}}c()(d,"ERROR_EVENTS",{"payer credit amount is not enough":"credit_not_enough_amount","User does not exist.":"credit_payee_not_exist","Invalid amount":"credit_invalid_amount","can not transfer to yourself":"can_not_transfer_to_yourself"});class p extends l["viewModel"].Form{constructor(){super(),this.items={receiver:new m["b"]({type:"text",icon:"qr_code",label:"收款码"}),amount:new m["b"]({type:"number",icon:"paid",label:"金额"})}}}var b=a("0d1c"),h=a("ac0b"),_={name:"Actions",data(){return{vm:new p,showTransferDialog:!1,showReceiveDialog:!1,form:new h["a"]({receiver:new h["b"]("",{type:"text",icon:"qr_code",label:"receipt_code"}),amount:new h["b"]("",{type:"number",icon:"paid",label:"transfer_amount"})})}},computed:{receiver(){const t=["23724a87-297d-4b82-a804-fef2d17f3aeb","df692820-8ab2-444f-aab8-ffc41bc2bce3"];return this.$store.state.account.sub===t[0]?t[1]:t[0]}},methods:{async getBonus(){const t=await Object(b["generalCommand"])("getTotalBonus");console.log(t)},transfer5(){u.transfer(this.receiver,5,"TRANSFER").catch((t=>{console.log(t),d.showRaw(t.message)}))},payData7(){u.transfer(this.receiver,7,"PAYDATA",{chunk_size:200,resource_name:"foo.mp4"}).catch((t=>{console.log(t),d.showRaw(t.message)}))},bonus99(){Object(b["testCommand"])("bonus",{amount:99}).catch((t=>{console.log(t),d.showRaw(t.message)}))},set100(){Object(b["testCommand"])("setCurrentCredit",{amount:100}).catch((t=>{console.log(t),d.showRaw(t.message)}))},async transfer(){try{const t=this.form.formData;await u.transfer(t.receiver,t.amount,"TRANSFER")}catch(t){d.showRaw(t.message)}return!0},async copyCode(){return await navigator.clipboard.writeText(this.$store.state.account.sub),this.$q.notify({message:this.$t("copied"),type:"positive",position:"bottom-right",timeout:5e3}),!0}}},g=_,f=a("2877"),y=a("f09f"),w=a("a370"),v=a("eb85"),D=a("eebe"),C=a.n(D),T=Object(f["a"])(g,n,o,!1,null,null,null),R=T.exports;C()(T,"components",{QCard:y["a"],QCardSection:w["a"],QSeparator:v["a"]});var x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("amplify-card",{staticClass:"col-11 col-grow items-start",staticStyle:{height:"fit-content","min-height":"240px","min-width":"320px"},attrs:{bordered:"",flat:"",cancelable:!1,title:t.$t("transaction_details")}},[a("q-table",{attrs:{loading:t.loading,grid:"","hide-header":"","hide-pagination":"",data:t.tableData,pagination:t.pagination,"row-key":"id"},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"top",fn:function(){return[a("div",{staticClass:"transaction-header"},[a("div",{staticClass:"full-height full-width relative-position"},[a("amplify-button",{attrs:{immediate:"",label:t.$d(t.queryButtonLabel,"YM")}},[a("year-month-picker",{model:{value:t.currentQueryDate,callback:function(e){t.currentQueryDate=e},expression:"currentQueryDate"}})],1)],1)])]},proxy:!0},{key:"item",fn:function(e){return[a("div",{staticClass:"col-xs-12 col-sm-6 col-md-4"},[a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],staticStyle:{"border-radius":"4px"},attrs:{clickable:""},on:{click:function(){return t.selectedId=e.row.id}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{staticStyle:{opacity:"0.6"},attrs:{name:t.getTransactionIcon(e.row.category,e.row.isIncome),left:"",size:"2rem"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-body1"},[t._v(t._s(e.row.category))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.$d(new Date(e.row.time),"MDHms")))])],1),a("q-item-section",{attrs:{side:"",top:""}},[a("q-item-label",{staticClass:"text-body1 text-weight-bolder",class:e.row.isIncome?"text-green":"",attrs:{header:""}},[t._v("\n              "+t._s(e.row.amount)+"\n            ")]),a("q-badge",{attrs:{color:{FINISH:"green",FAILED:"orange",COMPLETED:"blue",PENDING:"grey"}[e.row.status],label:e.row.status}})],1)],1)],1)]}},{key:"bottom",fn:function(){return[a("div",{staticClass:"flex flex-center q-pt-md full-width"},[a("q-pagination",{attrs:{color:"grey-8",max:t.pagesNumber,"max-pages":5,ellipses:!1,"boundary-numbers":!1,"direction-links":"","boundary-links":"",size:"md"},model:{value:t.pagination.page,callback:function(e){t.$set(t.pagination,"page",e)},expression:"pagination.page"}})],1)]},proxy:!0}])}),a("amplify-dialog",{attrs:{title:t.$t("transaction_details")},model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}},[t.showDialog?a("q-list",{staticClass:"rounded-borders",attrs:{bordered:"",separator:""}},[a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("transaction_id")))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.selectedItem.id))])],1)],1),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t(t.selectedItem.isIncome?"transaction_payer":"transaction_payee")))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.selectedItem.target))])],1)],1),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("transaction_category")))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.selectedItem.category))])],1)],1),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("transaction_changed_amount")))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.selectedItem.amount))])],1)],1),t.selectedItem.meta?a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("transaction_meta")))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.selectedItem.meta))])],1)],1):t._e(),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("transaction_status")))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.selectedItem.status))])],1)],1),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("transaction_creation_time")))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(t.$d(new Date(t.selectedItem.time),"YMDHms")))])],1)],1)],1):t._e()],1)],1)},I=[],q=(a("ddb0"),a("4e82"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-popup-proxy",{attrs:{"before-show":t.updateProxyDate,"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{ref:"picker",attrs:{value:t.proxyDate,minimal:"",landscape:"",locale:t.locale,"navigation-max-year-month":t.maxYearMonth,"default-year-month":t.maxYearMonth,mask:"YYYY-MM-DD","default-view":"Months","emit-immediately":!0,"years-in-month-view":!0},on:{input:t.handleInput}},[a("div",{staticClass:"row items-center justify-end q-gutter-sm"},[a("div",[t._v(t._s(t.proxyDate))]),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Latest",color:"primary",flat:""},on:{click:t.handleLatest}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Cancel",color:"primary",flat:""}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"OK",color:"primary",flat:""},on:{click:t.handleClick}})],1)])],1)}),E=[],$={name:"YearMonthPicker",props:{value:{type:Date}},data(){const t=this,e={proxyDate:null};e.locale={days:"Domingo_Lunes_Martes_Miércoles_Jueves_Viernes_Sábado".split("_"),daysShort:"Dom_Lun_Mar_Mié_Jue_Vie_Sáb".split("_"),months:"Enero_Febrero_Marzo_Abril_Mayo_Junio_Julio_Agosto_Septiembre_Octubre_Noviembre_Diciembre".split("_"),firstDayOfWeek:1,monthsShort:Array.from({length:12},((e,a)=>t.$d(new Date(`2000-${a+1}-1`),"M")))};const a=new Date,i=a.getFullYear(),s=a.getMonth()+1;return e.maxYearMonth=`${i}/${s<10?"0":""}${s}`,e},created(){this.updateProxyDate()},methods:{updateProxyDate(){var t;const e=null!==(t=this.value)&&void 0!==t?t:new Date;this.proxyDate=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`},handleInput(t,e){this.$refs.picker.setView("Months"),this.proxyDate=t},handleClick(){this.$emit("input",new Date(this.proxyDate))},handleLatest(){const t=new Date,e=`${t.getFullYear()}-${t.getMonth()+1}-2`;this.handleInput(e,"latest"),this.handleClick()}}},N=$,k=a("7cbe"),A=a("52ee"),S=a("9c40"),O=a("7f67"),M=Object(f["a"])(N,q,E,!1,null,"048a91db",null),P=M.exports;C()(M,"components",{QPopupProxy:k["a"],QDate:A["a"],QBtn:S["a"]}),C()(M,"directives",{ClosePopup:O["a"]});const{expensesWithDateLiveData:Q,incomeWithDateLiveData:L}=b;async function Y(t,[e,a]){Q.disable(),L.disable(),Q.addOnChangedListener(e),L.addOnChangedListener(a),await Promise.all([await Q.enable(t),await L.enable(t)])}async function j(){await Promise.all([await Q.fetchNext(),await L.fetchNext()])}function F(){Q.disable(),L.disable()}const B=(t,e)=>({TRANSFER:"paid",PAYDATA:e?"cloud_upload":"cloud_download",BONUS:"card_giftcard",RECHARGE:"account_balance_wallet"}[t]);var J={name:"Transaction",components:{YearMonthPicker:P},data(){return{expensesTransaction:[],incomeTransaction:[],currentQueryDate:null,getTransactionIcon:B,loading:!0,selectedId:null,pagination:{sortBy:"time",descending:!0,page:1,rowsPerPage:9}}},computed:{tableData(){const t=[...this.expensesTransaction,...this.incomeTransaction];t.sort(((t,e)=>Date.parse(e.createdAt)-Date.parse(t.createdAt)));const e=t=>{const e=t=>this.$store.state.account.sub===t.payeeId,a={};return a.time=Date.parse(t.createdAt),a.isIncome=e(t),a.id=t.id,a.category=t.category,a.amount=`${e(t)?"+":"-"}${t.amount}`,a.status=t.status,a.target=e(t)?t.payerId:t.payeeId,a.meta=t.meta?JSON.parse(t.meta):null,a};return t.map(e)},selectedItem(){return this.selectedId?this.tableData.find((t=>t.id===this.selectedId)):null},currentPageNumber(){return this.pagination.page},queryButtonLabel(){const t=9*(this.currentPageNumber-1),e=this.tableData[t];return e?new Date(e.time):this.currentQueryDate?this.currentQueryDate:new Date},pagesNumber(){return Math.ceil(this.tableData.length/this.pagination.rowsPerPage)},showDialog:{get(){return null!==this.selectedId},set(t){this.selectedId=t||null}}},mounted(){this.currentQueryDate=new Date},watch:{async currentPageNumber(t){if(t===this.pagesNumber)try{this.loading=!0,await j()}catch(e){d.showNegative(e.message)}finally{this.loading=!1}},async currentQueryDate(t,e){if(!t)return;const a=t=>(t=new Date(t),new Date(t.getUTCFullYear(),t.getUTCMonth()+1,1).toISOString());if(!e||a(t)!==a(e))try{this.loading=!0,await Y(a(t),[t=>this.expensesTransaction=t,t=>this.incomeTransaction=t])}catch(i){d.showNegative(i.message)}finally{this.loading=!1}}},beforeDestroy(){F(),this.expensesTransaction=[],this.incomeTransaction=[]}},U=J,H=(a("a9cc"),a("eaac")),V=a("66e5"),z=a("4074"),W=a("0016"),G=a("0170"),K=a("58a81"),X=a("3b16"),Z=a("1c1c"),tt=a("714f"),et=Object(f["a"])(U,x,I,!1,null,"4bcf19e8",null),at=et.exports;C()(et,"components",{QTable:H["a"],QItem:V["a"],QItemSection:z["a"],QIcon:W["a"],QItemLabel:G["a"],QBadge:K["a"],QPagination:X["a"],QList:Z["a"]}),C()(et,"directives",{Ripple:tt["a"]});var it={name:"Credits",components:{Actions:R,Transaction:at}},st=it,nt=a("9989"),ot=Object(f["a"])(st,i,s,!1,null,null,null);e["default"]=ot.exports;C()(ot,"components",{QPage:nt["a"]})},f33d:function(t,e,a){}}]);