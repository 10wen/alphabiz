(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{"2e03":function(t,e,a){},"426d":function(t,e,a){"use strict";a("2e03")},"52af":function(t,e,a){},"5bd9":function(t,e,a){},7846:function(t,e,a){"use strict";a("5bd9")},9176:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticStyle:{position:"relative"}},[a("input",{ref:"file",staticStyle:{display:"none"},attrs:{id:"media-file-upload",type:"file","data-cy":"file-input"},on:{input:t.manualAddFile}}),a("input",{ref:"subtitle",staticStyle:{display:"none"},attrs:{type:"file",accept:".srt,.vtt"},on:{input:t.manualAddSubtitle}}),a("div",{staticStyle:{position:"absolute",height:"100%",width:"100%"},attrs:{id:"video-container",lang:t.lang}},[a("video",{ref:"video",staticClass:"video-js vjs-default-skin vjs-16-9 vjs-big-play-centered vjs-fluid",staticStyle:{height:"100%"},attrs:{crossorigin:"anonymous",id:"my-video"}})]),a("audio-info",{attrs:{show:t.isAudio}}),a("video-splash",{attrs:{show:t.showSplash,videoLoadingHint:t.$t("waiting_for_torrent")}}),a("advanced-options",{attrs:{show:t.showAdvancedOptions,advancedOptions:t.advancedOpt},on:{close:function(){return t.toggleAdvancedOptions(!1)}}})],1)},i=[],n=(a("5319"),a("ddb0"),a("2b3d"),a("9861"),a("f0e2")),o=a("6922"),l=a.n(o);a("fda2"),a("7f10"),a("5898");const r=a("3e8f"),d=a("df7c");function c(t){if(console.log(t.path||t),!r.existsSync(t.path||t))return[];const e=d.dirname(t.path),a=d.extname(t.path),s=t.name.substring(0,t.name.lastIndexOf("."));console.log(e,s,a);const i=h(e,s),n=p(e,i),o=g(e,s),l=u(e,o);return[...n,...l]}function u(t,e){const a=[];try{e.forEach(((e,s,i)=>{i[s]=t+"/"+e;const n=r.readFileSync(i[s],"utf-8"),o=1===(e.match(/\./g)||[]).length?e:d.extname(e.substring(0,e.lastIndexOf("."))).substring(1)+".srt";a.push({src:URL.createObjectURL(new Blob([y(n)])),label:o,path:t+"\\"+e})}))}catch(s){console.log(s)}return console.log(a),a}function p(t,e){const a=[];try{e.forEach(((e,s,i)=>{i[s]=t+"/"+e;const n=r.readFileSync(i[s],"utf-8"),o=1===(e.match(/\./g)||[]).length?e:d.extname(e.substring(0,e.lastIndexOf("."))).substring(1)+".vtt";a.push({src:URL.createObjectURL(new Blob([n])),label:o,path:t+"\\"+e})}))}catch(s){console.log(s)}return console.log(a),a}function h(t,e){let a;try{a=r.readdirSync(t),a=a.filter((t=>t.startsWith(e)&&t.endsWith(".vtt")))}catch(s){console.log(s)}return a}function g(t,e){let a;try{a=r.readdirSync(t),a=a.filter((t=>t.startsWith(e)&&t.endsWith(".srt")))}catch(s){console.log(s)}return a}function y(t){var e=t.replace(/\r+/g,"");e=e.replace(/^\s+|\s+$/g,"");var a=e.split("\n\n"),s="";if(a.length>0){s+="WEBVTT\n\n";for(var i=0;i<a.length;i+=1)s+=f(a[i])}return s}function f(t){var e="",a=t.split(/\n/);while(a.length>3){for(var s=3;s<a.length;s++)a[2]+="\n"+a[s];a.splice(3,a.length-3)}var i=0;if(!a[0].match(/\d+:\d+:\d+/)&&a[1].match(/\d+:\d+:\d+/)&&(e+=a[0].match(/\w+/)+"\n",i+=1),!a[i].match(/\d+:\d+:\d+/))return"";var n=a[1].match(/(\d+):(\d+):(\d+)(?:,(\d+))?\s*--?>\s*(\d+):(\d+):(\d+)(?:,(\d+))?/);return n?(e+=n[1]+":"+n[2]+":"+n[3]+"."+n[4]+" --\x3e "+n[5]+":"+n[6]+":"+n[7]+"."+n[8]+"\n",i+=1,a[i]&&(e+=a[i]+"\n\n"),e):""}const m=a("ed08").isElectron();function v(t){if(!m||"string"!==typeof t)return t;const e=a("df7c"),s=e.basename(t);return{name:s,path:t}}var b=a("307e"),S=a("4d5f"),w=a("0613"),_=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],attrs:{id:"video-splash"}},[a("div",{staticClass:"loading"},[a("q-circular-progress",{staticClass:"q-ma-md",attrs:{indeterminate:"",size:"24px",color:"primary"}}),a("p",[t._v(t._s(t.videoLoadingHint))])],1)])])},x=[],P={name:"VideoSplash",props:{show:{type:Boolean},videoLoadingHint:{type:String}},data(){return{}},created(){},mounted(){},computed:{},methods:{}},C=P,$=(a("426d"),a("2877")),O=a("58ea"),T=a("eebe"),V=a.n(T),k=Object($["a"])(C,_,x,!1,null,"077eff30",null),A=k.exports;V()(k,"components",{QCircularProgress:O["a"]});var B=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"audio-info-container"},[a("p",{staticClass:"info"},[t._v(t._s(t.$t("this_is_an_audio_file")))]),a("img",{attrs:{src:"favicon.ico",alt:"favicon",width:"100px"}})])])},L=[],j={name:"AudioInfo",components:{},props:{show:{type:Boolean}},data(){return{}},created(){},mounted(){},computed:{},methods:{}},q=j,R=(a("7846"),Object($["a"])(q,B,L,!1,null,"abfb3674",null)),U=R.exports,F=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-dialog",{attrs:{value:t.show},on:{input:t.close}},[a("q-card",{staticStyle:{width:"600px","max-width":"80vw","overflow-x":"hidden"}},[a("q-card-section",{staticClass:"row"},[a("div",{staticClass:"text-h6 col-12"},[t._v(t._s(t.$t("advanced_options")))])]),a("q-card-section",{staticClass:"row"},[a("div",{staticClass:"col-4 justify-start q-pl-xl q-my-md"},[t._v(t._s(t.advancedOptions[0].name)+":")]),a("div",{staticClass:"col-8 justify-start q-pl-md q-my-md",staticStyle:{"word-wrap":"break-word"}},[t._v(t._s(t.advancedOptions[0].value))]),a("div",{staticClass:"col-4 justify-start q-pl-xl q-my-md"},[t._v(t._s(t.advancedOptions[1].name)+":")]),a("div",{staticClass:"col-8 justify-start q-pl-md q-my-md",staticStyle:{"word-wrap":"break-word"}},[t._v(t._s(t.advancedOptions[1].value))]),a("div",{staticClass:"col-4 justify-start q-pl-xl q-my-md"},[t._v(t._s(t.advancedOptions[2].name)+":")]),a("div",{staticClass:"col-8 justify-start q-pl-md q-my-md",staticStyle:{"word-wrap":"break-word"}},t._l(t.advancedOptions[2].value,(function(e,s){return a("div",{key:s,staticClass:"license-section"},[t._v("\n          "+t._s(e.label)+"\n        ")])})),0)])],1)],1)},H=[],I={name:"AdvancedOptions",components:{},props:{show:Boolean,advancedOptions:Array},data(){return{}},created(){},mounted(){},computed:{},methods:{close(){this.$emit("close")}}},E=I,M=a("24e8"),W=a("f09f"),N=a("a370"),Q=Object($["a"])(E,F,H,!1,null,"5c3e2e5d",null),z=Q.exports;V()(Q,"components",{QDialog:M["a"],QCard:W["a"],QCardSection:N["a"]});const D=a("ed08").isElectron();let J=null;D&&(J=a("bdb9").ipcRenderer),window.videojs=n["default"],a("d80d"),a("01a0"),a("8d5e");var G={name:"Player",inject:["rootApp","io"],components:{VideoSplash:A,AudioInfo:U,AdvancedOptions:z},data(){return{player:null,playerOptions:{plugins:{hotkeys:l.a},autoplay:!0,preload:"auto",controls:!0,controlBar:{volumePanel:{inline:!1}}},subsBtn:null,progress:0,fileName:"",playerLang:"",trackSettingsStatus:"false",subtitleList:[],showSplash:!1,showAdvancedOptions:!1,isAudio:!1}},created(){this.initVideoComponent(),this.playerLang=w["a"].state.setting.language,window.addEventListener("error",(t=>{console.log("Uncaught global error",t.message,"\nThis has no effect to app and can be ignore")})),D&&("Alphabiz"===this.settings.defaultVideoPlayer&&J.send("request-ask-for-player"),J.on("ask-for-player",(()=>{this.$q.notify({message:this.$t("not_default_player"),actions:[{label:this.$t("dont_show_again"),handler:()=>{w["a"].dispatch("set",{dontAskForPlayer:!0})}},{label:this.$t("go_to_settings"),handler:()=>{this.$router.push("/basicSetting")}}]})})))},mounted(){this.loadPlayer(!0)},async activated(){this.playerLang!==w["a"].state.setting.language&&(this.playerLang=w["a"].state.setting.language,this.languageChange()),D&&(w["a"].state.video.currentVideo.remotePlay&&(this.loadPlayer(!0),this.toggleSplash(!0),J.send("get-stream-address"),J.once("stream-address",((t,e)=>{this.toggleSplash(!1);const{address:a,filepath:s}=e;console.log("Stream play, try update player.src",e,a,s),w["a"].dispatch("currentVideoUrl",a),w["a"].dispatch("currentVideoPath",s);try{this.updateSrc(a),this.player.play(),w["a"].dispatch("resetRemotePlay"),this.clearOldSubtitle(),this.addSubtitle(s)}catch(t){console.log("src err",t),w["a"].dispatch("resetRemotePlay")}}))),w["a"].state.video.currentVideo.url||w["a"].state.video.currentVideo.infoHash||this.loadPlayer(!0)),this.io.on("server_progress",(t=>{if("/player"!==this.$router.currentRoute.path)return;if(!this.player||!this.player.readyState())return;const e=t.find((t=>{var e;return null===(e=w["a"].state.video.currentVideo)||void 0===e?void 0:e.url.includes(t.name)}));if(e&&e.progress){const t=[],a=e.progress.length;let s=e.progress[0],i=1;for(let n=1;n<a;n++)if(e.progress[n]===s&&n<a-1)i+=1;else{if(e.progress[n+1]===s){i+=1;continue}n===a-1&&(i+=1),i&&t.push({color:1===s?"gold":"transparent",length:i/a*100+"%"}),s=e.progress[n],i=1}this.updateProgress(t)}}))},beforeDestroy(){this&&this.player&&this.player.dispose()},computed:{lang(){const t=w["a"].state.setting.language?w["a"].state.setting.language:"en-US";return this.player&&this.player.language(t),t},settings(){const t=w["a"].state.setting;return{defaultVideoPlayer:t.defaultVideoPlayer}},advancedOpt(){let t=w["a"].state.video.currentVideo.path;const e=w["a"].state.video.currentVideo.url;e.startsWith("play://")&&(t=decodeURI(e).replace("play:///","").replace(/\//g,"\\"));const a=t?t.match(/(?:.(?!\\))+$/):this.fileName;return[{name:this.$t("title"),value:decodeURIComponent(a).replace("\\","")},{name:this.$t("location"),value:t},{name:this.$t("subtitle_file"),value:this.subtitleList}]}},watch:{"$store.state.video.currentVideo.updatePlayer"(t,e){console.log("watch updatePlayer:",t),t&&t!==e&&(console.log("need update player"),w["a"].dispatch("updatePlayer",!1),this.updatePlayer(w["a"].state.video.currentVideo.url))}},methods:{toggleSplash(t){this.showSplash=t},toggleAudio(t){this.isAudio=t},toggleAdvancedOptions(t){this.showAdvancedOptions=t},openFile(){this.$refs.file.click()},async languageChange(){this.player&&(this.player.language(this.lang),this.updateComponentText(),w["a"].state.video.currentVideo.url&&await this.loadPlayer(!0))},manualAddFile(t){console.log("Open Media File: "+t.target.files[0].name),0!==t.target.files.length&&(t.target.files[0].path&&w["a"].dispatch("currentVideoPath",t.target.files[0].path),this.updatePlayer(t.target.files[0]),setTimeout((()=>{this.$refs.file.value=null}),500))},async manualAddSubtitle(t){const e=t.target.files;if(!e.length)return;const a=e[0];console.log("manualAddSubtitle",a,a.name);const s=this.player.textTracks();await this.addSubtitle(a,a.name);let i=-1;setTimeout((()=>{for(let t=0;t<s.length;t++)a.name.includes(s[t].label)&&(i=t),s[t].mode="disabled";-1!==i&&(s[i].mode="showing"),this.appendAddSubBtn(),t.target.value=""}),500)},initVideoComponent(){const t=n["default"].getComponent("Button"),e=n["default"].getComponent("MenuItem");n["default"].registerComponent("FileButton",n["default"].extend(t,{constructor:function(){t.apply(this,arguments);const e=arguments[1];this._text=e.text||"Open File...",this.el_.innerHTML=`<span class="open" title="${this._text}"></span>`,this.updateTitle=function(t){this.el_.innerHTML=`<span class="open" title="${t}"></span>`}}})),n["default"].registerComponent("SubsButton",n["default"].extend(t,{constructor:function(){t.apply(this,arguments);const e=arguments[1];this._text=e.text||"Add subtitles...",this.el_.innerHTML=`<span class="subs" title="${this._text}"></span>`,this.updateTitle=function(t){this.el_.innerHTML=`<span class="subs" title="${t}"></span>`}}})),n["default"].registerComponent("AddSubButton",n["default"].extend(e,{constructor:function(){e.apply(this,arguments);const t=arguments[1];this._text=t.text||"Add subtitles...",this.el_.innerHTML+=`<span>${this._text}</span>`}})),n["default"].registerComponent("AdvancedOptionsButton",n["default"].extend(t,{constructor:function(){t.apply(this,arguments);const e=arguments[1];this._text=e.text||"Advanced Options",this.el_.innerHTML=`<span class="advanced" title="${this._text}"></span>`,this.updateTitle=function(t){this.el_.innerHTML=`<span class="advanced" title="${t}"></span>`}}}))},addControlBarComponent(){const t=this.player.controlBar.addChild("FileButton",{text:this.$t("open_file")},1);t.on("click",this.openFile),this.subsBtn=this.player.controlBar.addChild("SubsButton",{text:this.$t("add_subtitles")},14),this.subsBtn.on("click",(()=>this.$refs.subtitle.click()));const e=this.player.controlBar.addChild("AdvancedOptionsButton",{text:this.$t("advanced_options")},16);e.on("click",(()=>{this.player.isFullscreen()&&this.player.exitFullscreen(),this.toggleAdvancedOptions(!0)}))},updateComponentText(){const t=this.player.controlBar.getChild("FileButton");t.updateTitle(this.$t("open_file")),this.subsBtn.updateTitle(this.$t("add_subtitles"));const e=this.player.controlBar.getChild("AdvancedOptionsButton");e.updateTitle(this.$t("advanced_options"))},loadPlayer(t=!1){let e=()=>{};const a=new Promise((t=>{e=t}));if(!n["default"].getPlayer("my-video")||t){if(t){Object(n["default"])("my-video")&&Object(n["default"])("my-video").dispose();const t=document.querySelector("#video-container");t&&(t.innerHTML='<video\n            crossorigin="anonymous"\n            id="my-video"\n            class="video-js vjs-default-skin vjs-16-9 vjs-big-play-centered vjs-fluid"\n            ref="video"\n            style="height:100%"\n          ></video>')}if(this.player=Object(n["default"])("my-video",this.playerOptions,(()=>e())),this.player.on("ready",(async()=>{w["a"].dispatch("updateVideoStatus",!1),this.player.language(this.lang),this.updateComponentText()})),this.player.on("canplay",(()=>{const t=document.querySelector("#my-video video");t&&(t.style.backgroundColor="black");const e=(D?w["a"].state.video.currentVideo.path:this.fileName).split(".").pop();Object(b["b"])(e)?this.toggleAudio(!0):this.toggleAudio(!1)})),this.player.on("play",(async()=>{if("Alphabiz"!==this.settings.defaultVideoPlayer&&w["a"].state.video.currentVideo.url.startsWith("play://")){this.player.pause(),this.player.exitPictureInPicture();const t=w["a"].state.video.currentVideo.path;console.log("player will pause,open default player,"+t),await Object(S["b"])(this.settings.defaultVideoPlayer,t),w["a"].dispatch("resetRemotePlay"),w["a"].dispatch("resetInfoHash"),w["a"].dispatch("currentVideoUrl",""),w["a"].dispatch("currentVideoPath",""),this.loadPlayer(!0)}else w["a"].dispatch("updateVideoStatus",!0)})),this.player.on("pause",(()=>{w["a"].dispatch("updateVideoStatus",!1)})),this.player.on("leavepictureinpicture",(()=>{w["a"].dispatch("updateVideoPIPStatus",!1),this.$router.push("/player")})),this.player.on("enterpictureinpicture",(()=>{w["a"].dispatch("updateVideoPIPStatus",!0),setTimeout((()=>this.player.play()),500)})),this.player.on("timeupdate",(()=>{w["a"].dispatch("currentVideoCurrentTime",this.player.currentTime())})),this.player.on("error",(()=>{this.toggleSplash(!1);const t=this.player.languages()[this.player.language()],e=t&&t[this.player.error_.message]||this.player.error_.message;this.$q.notify(e),w["a"].dispatch("currentVideoUrl",null),w["a"].dispatch("currentVideoPath",null),this.loadPlayer(!0)})),this.player.textTracks().on("change",(()=>{})),this.player.textTrackSettings.on("beforemodalopen",(()=>{this.trackSettingsStatus=!0})),this.player.textTrackSettings.on("beforemodalclose",(()=>{this.trackSettingsStatus=!1})),w["a"].state.video.currentVideo.url&&!w["a"].state.video.currentVideo.remotePlay){console.log("reload resources after modify code in dev mode!");const t=this.subtitleList,e=w["a"].state.video.currentVideo.status;if(this.updateSrc(w["a"].state.video.currentVideo.url),this.player.currentTime(w["a"].state.video.currentVideo.currentTime),console.log("loadplayer(force) status",e),!e){const t=()=>{this.player.pause(),this.trackSettingsStatus&&this.player.textTrackSettings.open(),this.player.off("play",t)};this.player.on("play",t)}t&&this.restoreSub(t)}return this.player.bigPlayButton.on("click",this.openFile),this.addControlBarComponent(),w["a"].dispatch("updateVideoPIPStatus",!1),a}this.player=n["default"].getPlayer("my-video")},async updatePlayer(t){if(!t)return;this.player||await this.loadPlayer();const e="string"===typeof t?t:URL.createObjectURL(t);console.log("updatePlayer()",t,e),this.fileName=t.name,w["a"].dispatch("currentVideoUrl",e),this.updateSrc(e),w["a"].dispatch("resetInfoHash"),this.clearOldSubtitle(),await this.addSubtitle(t,t.name)},updateSrc(t){this.toggleAudio(!1),this.subtitleList=[],t.startsWith("play://")&&(t+=`?infoHash=${w["a"].state.video.currentVideo.infoHash}`),console.log("updateSrc()",t),this.player.src([{src:t,type:"video/mp4"}])},updateProgress(t){if(t){let e=document.querySelector("#download-progress");if(!e){const t=document.querySelector(".vjs-progress-holder");if(!t)return;e=t.appendChild(document.createElement("div")),e.id="download-progress"}e.style.background=t.reduce(((t,e)=>t+`, ${e.color} 0%, ${e.color} ${e.length}, ${e.color} 0%`),"linear-gradient(90deg")+", transparent 0%)"}},async addSubtitle(t,e){var a;let s=t;if("string"===typeof t){if(t.startsWith("blob:"))return;s=t.startsWith("play://")?v(decodeURI(t.replace("play:///",""))):v(t)}e||(e=(null===(a=s)||void 0===a?void 0:a.name)||"");const i=e.match(/\.[^.]+$/)[0].toLowerCase();if(!i)return;console.log("addSubtitle() sub",s,e);let n=!1,o=!1;if(D)[".ass"].includes(i)?console.log("add .ass sub"):await Promise.all(c(s).map((t=>(n=!0,new Promise((a=>{setTimeout((()=>{o=this.isRepeatSubtitle(t.label),console.log("obj",t,o),o||(this.player.addRemoteTextTrack({kind:"captions",label:t.label||e,src:t.src},!0),this.updateSubtitleList(t.label||e,t.path)),a()}))}))))));else{if(console.log("web addSubtitle()"),![".srt",".vtt"].includes(i))return;o=this.isRepeatSubtitle(e),o||await new Promise((t=>{const a=new FileReader;a.readAsText(s),a.onload=a=>{const s=".vtt"===i?a.target.result:y(a.target.result);this.player.addRemoteTextTrack({src:URL.createObjectURL(new Blob([s])),kind:"captions",label:e},!0),this.updateSubtitleList(e,""),n=!0,t()}}))}if(n){this.subsBtn.addClass("hidden");const t=this.player.textTracks();t&&t[0]&&(t[0].mode="showing"),this.appendAddSubBtn()}},isRepeatSubtitle(t){const e=this.player.textTracks();let a=!1;for(let s=0;s<e.length;s++)t.includes(e[s].label)&&(a=!0);return a},updateSubtitleList(t,e){this.subtitleList.push({label:t,path:e})},clearOldSubtitle(){if(!this.subsBtn)return;this.subsBtn.removeClass("hidden");const t=this.player.remoteTextTracks();for(let e=t.length-1;e>=0;e--)this.player.removeRemoteTextTrack(t[e])},restoreSub(t){console.log("restoreSub()"),this.subtitleList=[],t.forEach((async(t,e)=>{console.log(t,e),t.path&&await this.addSubtitle(t.path)}))},appendAddSubBtn(){const t=this;setTimeout((()=>{const e=this.player.controlBar.subsCapsButton,a=e.menu.children();if(!a)return;if(a.some((t=>"AddSubButton"===t.name_)))return;const s=e.menu.addChild("AddSubButton",{text:t.$t("add_subtitles")},2);s.addClass("add-sub-btn"),s.on("click",(()=>{this.$refs.subtitle.click()}))}),1e3)}}},K=G,X=(a("941d"),a("9989")),Y=Object($["a"])(K,s,i,!1,null,null,null);e["default"]=Y.exports;V()(Y,"components",{QPage:X["a"]})},"941d":function(t,e,a){"use strict";a("52af")}}]);