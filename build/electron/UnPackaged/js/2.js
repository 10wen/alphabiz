(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"0cf9":function(t,e,a){"use strict";a("762d")},"156a":function(t,e,a){"use strict";a("a71e")},"15ce":function(t,e,a){"use strict";a("e8f1")},"18a0":function(t,e,a){},"19bf":function(t,e,a){"use strict";a("d226")},"29ed":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{attrs:{padding:""}},[a("header",{staticClass:"text-h5 q-pb-sm",staticStyle:{"border-bottom":"1px solid #bbb"}},[t._v("\n    "+t._s(this.$t("account_account_setting"))+"\n  ")]),a("article",[a("optional-information",{attrs:{loading:t.loading},on:{setLoading:t.setLoading}}),a("verification-fields",{attrs:{loading:t.loading},on:{setLoading:t.setLoading}}),a("OAuthManager",{ref:"oauthManager",attrs:{loading:t.loading},on:{setLoading:t.setLoading}}),a("security"),a("invitation",{ref:"invitation",attrs:{loading:t.loading},on:{setLoading:t.setLoading}})],1)])},o=[],n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-form",{on:{submit:t.submit,reset:t.fetchUser}},[a("setting-fragment",{attrs:{label:t.$t("account_personal_information")}},[a("div",{staticClass:"account-setting__information"},[t._l(t.form.items,(function(e,i,o){return["input"===e.type?a("amplify-input",t._b({key:i,style:{marginBottom:"4px",width:"100%"},attrs:{label:t.$t(e.bound.label),readonly:t.loading},model:{value:e.model,callback:function(a){t.$set(e,"model",a)},expression:"item.model"}},"amplify-input",e.bound,!1)):"select"===e.type?a("amplify-select",t._b({key:i,style:{marginBottom:o===t.form.length-1?"4px":"24px",width:"100%"},attrs:{readonly:t.loading,align:""},model:{value:e.model,callback:function(a){t.$set(e,"model",a)},expression:"item.model"}},"amplify-select",e.bound,!1)):t._e()]}))],2)]),a("setting-actions",{attrs:{loading:t.changing,"reset-label":t.$t("account_reset"),"submit-label":t.$t("account_submit")}})],1)},s=[],l=(a("a79d"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"setting-actions"},[a("q-btn",{staticClass:"bg-primary text-white",attrs:{size:"md",type:"submit",align:"around","no-wrap":"",label:t.submitLabel,flat:"",loading:t.loading,disable:t.loading},scopedSlots:t._u([{key:"loading",fn:function(){return[a("q-spinner",{attrs:{color:"white"}})]},proxy:!0}])}),a("q-btn",{staticClass:"setting-btn",attrs:{size:"md",type:"reset",align:"around","no-wrap":"",label:t.resetLabel,flat:"",disable:t.loading}})],1)}),c=[],r={name:"SettingActions",props:{submitLabel:String,resetLabel:String,loading:Boolean}},d=r,u=(a("0cf9"),a("2877")),h=a("9c40"),m=a("0d59"),p=a("eebe"),g=a.n(p),f=Object(u["a"])(d,l,c,!1,null,"73a67682",null),_=f.exports;g()(f,"components",{QBtn:h["a"],QSpinner:m["a"]});var b=a("48f4"),v=a("ed08"),w=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:["setting-fragment"].concat(t.fragClz)},[a("div",{class:["setting-fragment__label"].concat(t.fragLabelClz)},[t._v(t._s(t.label))]),a("div",{class:["setting-fragment__content"].concat(t.fragContentClz)},[t._t("default")],2)])},y=[],$={name:"SettingFragment",props:{label:String},data(){return{fragClz:[],fragLabelClz:[],fragContentClz:[]}}},C=$,D=(a("19bf"),Object(u["a"])(C,w,y,!1,null,null,null)),S=D.exports,M=a("8e4e"),x=a("2cb1"),q=a("0d11"),k={name:"OptionalInformation",components:{SettingFragment:S,AlphabizInput:M["c"],AlphabizSelect:x["b"],SettingActions:_},props:{loading:Boolean},data(){return{changing:!1,form:null}},created(){this.form=new q["a"](this),this.fetchUser()},methods:{fetchUser(){this.form.updateModel(Object(v["deepClone"])(this.$store.getters.accountUserOptionalInfo))},submit(){this.$emit("setLoading",!0),this.changing=!0,b["b"].changeAttributes(this.form.formData).then((()=>b["d"].showPositive("changed"))).catch((t=>b["d"].showNegative(t.message))).finally((()=>{this.$emit("setLoading",!1),this.changing=!1}))}},watch:{"$store.getters.accountUserOptionalInfo"(t){this.fetchUser()}}},N=k,V=(a("5be0"),a("0378")),A=Object(u["a"])(N,n,s,!1,null,null,null),P=A.exports;g()(A,"components",{QForm:V["a"]});var T=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("setting-fragment",{attrs:{label:t.$t("account_contact_information")}},[a("q-list",{staticClass:"account-setting__verification",attrs:{bordered:"",separator:""}},t._l(t.items,(function(e,i){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple",value:!t.loading,expression:"!loading"}],key:i,attrs:{clickable:!t.loading,readonly:t.loading},on:{click:e.handleClick}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{staticStyle:{opacity:"0.7"},attrs:{name:e.icon}})],1),a("q-item-section",[a("q-item-label",[t._v(t._s(e.title))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(e.field||t.$t("account_not_set")))])],1),a("q-item-section",{attrs:{side:""}},[e.field&&e.verifiedLabel?a("q-badge",{attrs:{color:e.color,label:e.verifiedLabel}}):t._e()],1),a("q-tooltip",{attrs:{anchor:"center middle",self:"center middle","transition-show":"scale","transition-hide":"scale"}},[t._v("\n        "+t._s(e.verifiedLabel?t.$t("account_change"):t.$t("account_setting"))+"\n      ")])],1)})),1),t.dialogData?a("amplify-dialog",{attrs:{title:t.dialogData.title,"on-submit":t.dialogData.onSubmit},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.disable;return t._l(t.dialogData.form.items,(function(e,o){return a("amplify-input",t._b({key:o,staticStyle:{width:"309px"},attrs:{label:t.$t(e.bound.label),readonly:i},model:{value:e.model,callback:function(a){t.$set(e,"model",a)},expression:"item.model"}},"amplify-input",e.bound,!1))}))}}],null,!1,1359966940),model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}}):t._e()],1)},O=[],F=(a("ddb0"),a("ac0b")),I=a("8349");class L extends F["a"]{constructor(){super({phoneNumber:new F["b"](["86","","CN"],{type:"tel",icon:"phone",label:"account_phone_number",rules:F["e"].PhoneNumber})})}setDefault(t){var e;const a=null!==(e=I["c"][t])&&void 0!==e?e:I["c"]["en-us"],[i,o]=a.phones[0].split("-"),n=this.items.phoneNumber;return n.updateModel([i,n.value[1],o]),this}}var Q={name:"VerificationFields",components:{SettingFragment:S},props:{loading:Boolean},data(){return{dialogData:null,showDialog:!1,dialogVM:{show:!1,step:0,title:"title",tip:"tip"},handleSubmit:()=>null,formVM:null,waiting:!1}},computed:{items(){const t=t=>t?"green":"red",e=t=>this.$t(t?"account_verified":"account_unverified"),a={title:this.$t("account_email"),icon:"email",field:this.$store.state.account.email,color:t(this.$store.state.account.emailVerified),verifiedLabel:e(this.$store.state.account.emailVerified),handleClick:this.handleClickEmail},i={title:this.$t("account_phone_number"),icon:"phone",field:this.$store.state.account.phoneNumber,color:t(this.$store.state.account.phoneNumberVerified),verifiedLabel:e(this.$store.state.account.phoneNumberVerified),handleClick:this.handleClickPhoneNumber};return[a,i]}},methods:{handleClickEmail(){if(this.$store.state.account.identities.length>0)return void b["d"].showNegative("error_can_not_change_email_before_unbound_social_account");if("NOMFA"!==this.$store.state.account.preferredMFA)return void b["d"].showNegative("can_not_change_email_phone_with_mfa_enabled");if(!this.$store.state.account.phoneNumberVerified)return void b["d"].showNegative("can_not_change_email");const t=()=>{const t={title:this.$t("account_change_email"),form:new F["a"]({code:new F["b"]("",{type:"text",icon:"shield",label:"account_verification_code",rules:F["e"].VerificationCode})}),onSubmit:this.handleEmailSubmit};return t},e=()=>{const e={title:this.$t("account_change_email"),form:new F["a"]({email:new F["b"]("",{type:"email",icon:"email",label:"account_email"})}),onSubmit:async()=>{const e=await this.handleEmailSend();e&&(this.dialogData=t())}};return this.$store.state.account.email&&!this.$store.state.account.emailVerified&&e.form.updateModel({email:this.$store.state.account.email}),e};this.dialogData=e(),this.showDialog=!0},async handleEmailSend(){const t=this.dialogData.form.formData;if(t.email===this.$store.state.account.email&&this.$store.state.account.emailVerified)b["d"].showNegative("error_same_email");else try{return await b["b"].changeEmailSend(t.email),!0}catch({message:e}){b["d"].showNegative(e)}},async handleEmailSubmit(){const t=this.dialogData.form.formData;try{return await b["b"].changeEmailSubmit(t.code),b["d"].showPositive("changed"),!0}catch({message:e}){b["d"].showNegative(e)}},handleClickPhoneNumber(){if("NOMFA"!==this.$store.state.account.preferredMFA)return void b["d"].showNegative("can_not_change_email_phone_with_mfa_enabled");if(!this.$store.state.account.emailVerified)return void b["d"].showNegative("can_not_change_phone");const t=()=>{const t={title:this.$t("account_change_phone_number"),form:new F["a"]({code:new F["b"]("",{type:"text",icon:"shield",label:"account_verification_code",rules:F["e"].VerificationCode})}),onSubmit:this.handlePhoneNumberSubmit};return t},e=()=>{const e={title:this.$t("account_change_phone_number"),form:(new L).setDefault(this.$q.lang.getLocale().toLowerCase()),onSubmit:async()=>{const e=await this.handlePhoneNumberSend();e&&(this.dialogData=t())}};return this.$store.state.account.phoneNumber&&!this.$store.state.account.phoneNumberVerified&&e.form.updateModel({phoneNumber:this.$store.state.account.phoneNumber,phoneNumberCountryCode:this.$store.state.account.phoneNumberCountryCode}),e};this.dialogData=e(),this.showDialog=!0},async handlePhoneNumberSend(){const t=this.dialogData.form.formData,e="+"+t.phoneNumber[0]+t.phoneNumber[1],a=t.phoneNumber[2];if(e===this.$store.state.account.phoneNumber&&this.$store.state.account.phoneNumberVerified)b["d"].showNegative("error_same_phone");else try{return await b["b"].changePhoneNumberSend({phoneNumber:e,phoneNumberCountryCode:a}),!0}catch({message:i}){b["d"].showNegative(i)}},async handlePhoneNumberSubmit(){const t=this.dialogData.form.formData;try{return await b["b"].changePhoneNumberSubmit(t.code),b["d"].showPositive("changed"),!0}catch({message:e}){b["d"].showNegative(e)}}}},z=Q,E=(a("6ea8"),a("1c1c")),j=a("66e5"),B=a("4074"),R=a("0016"),U=a("0170"),G=a("58a81"),J=a("05c0"),K=a("714f"),W=Object(u["a"])(z,T,O,!1,null,null,null),H=W.exports;g()(W,"components",{QList:E["a"],QItem:j["a"],QItemSection:B["a"],QIcon:R["a"],QItemLabel:U["a"],QBadge:G["a"],QTooltip:J["a"]}),g()(W,"directives",{Ripple:K["a"]});var X=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("setting-fragment",{attrs:{label:t.$t("account_security")}},[a("security-change-password"),a("security-m-f-a"),a("security-delete-account")],1)},Y=[],Z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-btn",{staticClass:"normal-grey q-mt-xs q-mr-sm",staticStyle:{"min-width":"120px"},attrs:{padding:"8px",flat:"",label:t.$t("account_change_password")},on:{click:function(e){t.showChangePasswordDialog=!t.showChangePasswordDialog}}},[a("setting-dialog",{attrs:{title:t.$t("account_change_password")},on:{submit:t.changePassword},scopedSlots:t._u([{key:"default",fn:function(){return t._l(t.vm.items,(function(e,i,o){return a("alphabiz-input",{key:i,staticStyle:{width:"309px"},attrs:{autofocus:0===o,required:!0,readonly:t.loading,type:e.data.type,icon:e.data.icon,label:e.data.label,rules:e.data.rules},model:{value:t.vm.items[i].model,callback:function(e){t.$set(t.vm.items[i],"model",e)},expression:"vm.items[key].model"}})}))},proxy:!0}]),model:{value:t.showChangePasswordDialog,callback:function(e){t.showChangePasswordDialog=e},expression:"showChangePasswordDialog"}})],1)},tt=[],et=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-dialog",{attrs:{value:t.value,persistent:""},on:{input:t.handleInput}},[a("q-card",{staticStyle:{"min-width":"342px"}},[a("q-card-section",{staticClass:"q-px-lg q-pt-lg q-pb-sm"},[a("div",{staticClass:"text-h5 text-weight-bold q-pb-md"},[t._v(t._s(t.title))]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.$slots.description,expression:"$slots.description"}],staticStyle:{width:"100%",overflow:"hidden"}},[t._t("description")],2)]),a("q-form",{on:{submit:t.handleSubmit}},[a("q-card-section",{staticClass:"q-px-lg q-pt-none q-pb-lg q-gutter-y-lg"},[t._t("default")],2),a("q-separator",{staticClass:"q-mx-none"}),a("q-card-actions",{staticClass:"q-px-lg q-py-md",attrs:{align:"stretch",vertical:""}},[a("q-btn",{staticClass:"bg-primary text-white q-mb-xs",attrs:{flat:"",label:t.$t("account_submit"),size:"md",type:"submit",loading:t.loading,"data-cy":"submit-btn"},scopedSlots:t._u([{key:"loading",fn:function(){return[a("q-spinner",{attrs:{color:"white"}})]},proxy:!0}])}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:t.$t("account_cancel"),size:"md",disable:t.loading,"data-cy":"cancel-btn"}})],1)],1)],1)],1)},at=[],it={name:"SettingDialog",props:{value:Boolean,title:String},data(){return{loading:!1}},methods:{handleInput(t){this.$emit("input",t)},handleSubmit(){this.loading=!0,this.$emit("submit",null,(()=>{this.loading=!1}))}}},ot=it,nt=(a("156a"),a("24e8")),st=a("f09f"),lt=a("a370"),ct=a("eb85"),rt=a("4b7e"),dt=a("7f67"),ut=Object(u["a"])(ot,et,at,!1,null,"0c58e531",null),ht=ut.exports;g()(ut,"components",{QDialog:nt["a"],QCard:st["a"],QCardSection:lt["a"],QForm:V["a"],QSeparator:ct["a"],QCardActions:rt["a"],QBtn:h["a"],QSpinner:m["a"]}),g()(ut,"directives",{ClosePopup:dt["a"]});var mt={name:"SecurityChangePassword",components:{SettingDialog:ht,AlphabizInput:M["c"]},data(){return{loading:!1,showChangePasswordDialog:!1,vm:new b["a"]}},watch:{showChangePasswordDialog(t){this.loading=!t,t||this.vm.clearData()}},methods:{changePassword(t,e){this.loading=!0;const a=()=>{e(),this.loading=!1},{currentPassword:i,newPassword:o}=this.vm.formData;b["b"].changePassword(i,o).then((()=>{this.showChangePasswordDialog=!1,b["d"].showPositive("password_has_been_reset")})).catch((t=>{const e="Incorrect username or password."===t.message?"incorrect_original_password":t.message;b["d"].showNegative(e)})).finally(a)}}},pt=mt,gt=(a("d98f"),Object(u["a"])(pt,Z,tt,!1,null,"b11c8f1a",null)),ft=gt.exports;g()(gt,"components",{QBtn:h["a"]});var _t=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-btn",{staticClass:"normal-grey q-mt-xs q-mr-sm",staticStyle:{"min-width":"120px"},attrs:{padding:"8px",flat:"",label:t.$t("account_set_mfa_type")},on:{click:t.handleClick}},[a("setting-dialog",{attrs:{title:t.$t("account_set_mfa_type")},on:{submit:t.setMfaType},model:{value:t.showSetMfaTypeDialog,callback:function(e){t.showSetMfaTypeDialog=e},expression:"showSetMfaTypeDialog"}},[a("template",{slot:"description"},[a("div",{staticStyle:{width:"309px"}},[t._v("\n        "+t._s(t.$t("account_tip_config_mfa"))+"\n      ")]),a("div",{staticClass:"q-pt-sm q-gutter-xs",staticStyle:{width:"309px"}},[t.mfaTypeOptions[0].disable?a("div",{staticClass:"normal-grey rounded-borders q-pa-md"},[t._v(t._s(t.$t("account_tip_can_not_enable_totp_mfa"))+"\n        ")]):t._e(),t.mfaTypeOptions[1].disable?a("div",{staticClass:"normal-grey rounded-borders q-pa-md"},[t._v(t._s(t.$t("account_tip_can_not_enable_sms_mfa"))+"\n        ")]):t._e()])]),a("template",{slot:"default"},[a("q-option-group",{attrs:{disable:t.loading,options:t.mfaTypeOptions,type:"radio"},model:{value:t.mfaType,callback:function(e){t.mfaType=e},expression:"mfaType"}})],1)],2),a("setting-dialog",{attrs:{title:t.$t("account_disable_mfa")},on:{submit:t.setNoMfa},model:{value:t.showNoMfaDialog,callback:function(e){t.showNoMfaDialog=e},expression:"showNoMfaDialog"}},[a("template",{slot:"description"},["SMS_MFA"===t.$store.state.account.preferredMFA?a("div",{staticStyle:{width:"309px"}},[t._v("\n        "+t._s(t.$t("account_phone_sent_tip"))+"\n        "),a("div",{staticClass:"inline-block normal-grey q-py-xs q-px-md rounded-borders"},[t._v("\n          "+t._s(t.$store.state.account.phoneNumber)+"\n        ")])]):a("div",{staticStyle:{width:"309px"}},[t._v(t._s(t.$t("account_tip_verify_totp")))])]),a("template",{slot:"default"},["SMS_MFA"===t.$store.state.account.preferredMFA?a("alphabiz-input",{attrs:{autofocus:"",required:"",type:"number",readonly:t.loading,label:t.$t(t.smsVerifyCodeVM.label),icon:t.smsVerifyCodeVM.icon},model:{value:t.smsVerifyCodeVM.value,callback:function(e){t.$set(t.smsVerifyCodeVM,"value",e)},expression:"smsVerifyCodeVM.value"}}):a("alphabiz-input",{attrs:{autofocus:"",required:"",type:"number",readonly:t.loading,label:t.$t(t.totpVerifyCodeVM.label),icon:t.totpVerifyCodeVM.icon},model:{value:t.totpVerifyCodeVM.value,callback:function(e){t.$set(t.totpVerifyCodeVM,"value",e)},expression:"totpVerifyCodeVM.value"}})],1)],2),a("setting-dialog",{attrs:{title:t.$t("account_sms_mfa")},on:{submit:t.setSmsMfa},model:{value:t.showSmsDialog,callback:function(e){t.showSmsDialog=e},expression:"showSmsDialog"}},[a("template",{slot:"description"},[a("div",{staticStyle:{width:"309px"}},[t._v("\n        "+t._s(t.$t("account_phone_sent_tip"))+"\n        "),a("div",{staticClass:"inline-block normal-grey q-py-xs q-px-md rounded-borders"},[t._v("\n          "+t._s(t.$store.state.account.phoneNumber)+"\n        ")])])]),a("template",{slot:"default"},[a("alphabiz-input",{attrs:{autofocus:"",required:"",type:"number",readonly:t.loading,label:t.$t(t.smsVerifyCodeVM.label),icon:t.smsVerifyCodeVM.icon},model:{value:t.smsVerifyCodeVM.value,callback:function(e){t.$set(t.smsVerifyCodeVM,"value",e)},expression:"smsVerifyCodeVM.value"}})],1)],2),a("setting-dialog",{attrs:{title:t.$t("account_totp_mfa")},on:{submit:t.setTotpMfa},model:{value:t.showTotpDialog,callback:function(e){t.showTotpDialog=e},expression:"showTotpDialog"}},[a("template",{slot:"description"},[a("ol",{staticClass:"q-ma-none q-pl-md",staticStyle:{"max-width":"324px",overflow:"hidden"}},[a("li",{directives:[{name:"show",rawName:"v-show",value:""!==t.totpSecretCode,expression:"totpSecretCode!==''"}]},[t._v(t._s(t.$t("account_tip_setup_totp")))]),a("li",[t._v(t._s(t.$t("account_tip_verify_totp")))])])]),a("template",{slot:"default"},[a("div",{directives:[{name:"show",rawName:"v-show",value:""!==t.totpSecretCode,expression:"totpSecretCode!==''"}]},[a("div",{staticClass:"qrcode q-mx-auto",on:{click:t.copyCode}},[a("canvas",{ref:"qrcode",staticClass:"full-width full-height"}),a("div",[t._v(t._s(t.$t("account_copy_code")))])])]),a("alphabiz-input",{attrs:{autofocus:"",required:"",type:"number",readonly:t.loading,label:t.$t(t.totpVerifyCodeVM.label),icon:t.totpVerifyCodeVM.icon},model:{value:t.totpVerifyCodeVM.value,callback:function(e){t.$set(t.totpVerifyCodeVM,"value",e)},expression:"totpVerifyCodeVM.value"}}),a("p",{directives:[{name:"show",rawName:"v-show",value:""===t.totpSecretCode,expression:"totpSecretCode===''"}],staticClass:"q-mb-none"},[t._v(t._s(t.$t("account_no_totp"))+"\n        "),a("a",{staticClass:"text-primary cursor-pointer hover-underline",attrs:{disable:t.loading},on:{click:t.setupTotp}},[t._v("\n        "+t._s(t.$t("account_setup_totp"))+"\n        ")])])],1)],2)],1)},bt=[],vt=(a("5319"),a("d055")),wt=a.n(vt),yt=a("5723"),$t={name:"SecurityMFA",components:{SettingDialog:ht,AlphabizInput:M["c"]},data(){return{loading:!1,mfaType:this.$store.state.account.preferredMFA,showSetMfaTypeDialog:!1,showNoMfaDialog:!1,showSmsDialog:!1,smsVerifyCodeVM:{value:"",label:"account_verification_code",icon:"shield"},showTotpDialog:!1,totpSecretCode:"",totpVerifyCodeVM:{value:"",label:"account_totp",icon:"shield"}}},computed:{mfaTypeOptions(){const t=!this.$store.state.account.email||!this.$store.state.account.phoneNumber||!this.$store.state.account.emailVerified||!this.$store.state.account.phoneNumberVerified,e=t;return[{label:this.$t("account_totp_mfa"),value:"SOFTWARE_TOKEN_MFA",disable:e},{label:`${this.$t("account_sms_mfa")} (${this.$t("account_not_recommend")})`,value:"SMS_MFA",disable:t},{label:this.$t("account_disable_mfa"),value:"NOMFA"}]}},watch:{showSetMfaTypeDialog(t){this.loading=!t,t||(this.mfaType=this.$store.state.account.preferredMFA)},showNoMfaDialog(t){t||(this.totpSecretCode="",this.totpVerifyCodeVM.value="",this.smsVerifyCodeVM.value="")},showSmsDialog(t){t||(this.smsVerifyCodeVM.value="")},showTotpDialog(t){t||(this.totpSecretCode="",this.totpVerifyCodeVM.value="")}},methods:{handleClick(){const t=!this.$store.state.account.email||!this.$store.state.account.phoneNumber||!this.$store.state.account.emailVerified||!this.$store.state.account.phoneNumberVerified;t?b["d"].showNegative("error_can_not_enable_mfa"):this.showSetMfaTypeDialog=!this.showSetMfaTypeDialog},async setMfaType(t,e){if(this.mfaType===this.$store.state.account.preferredMFA)return e(),void(this.showSetMfaTypeDialog=!1);const a=()=>{e(),this.loading=!1};try{this.loading=!0,"NOMFA"===this.mfaType?("SMS_MFA"===this.$store.state.account.preferredMFA&&await Object(yt["s"])("phone_number"),this.showNoMfaDialog=!0):"SMS_MFA"===this.mfaType?(await Object(yt["s"])("phone_number"),this.showSmsDialog=!0):"SOFTWARE_TOKEN_MFA"===this.mfaType&&(this.showTotpDialog=!0)}catch({message:i}){b["d"].showNegative(i)}finally{a()}},async setNoMfa(t,e){try{this.loading=!0,"SMS_MFA"===this.$store.state.account.preferredMFA?await Object(yt["u"])("phone_number",this.smsVerifyCodeVM.value):await Object(yt["q"])(this.totpVerifyCodeVM.value),await b["b"].setMfaType(this.mfaType),b["d"].showPositive("changed"),this.showNoMfaDialog=!1,this.showSetMfaTypeDialog=!1}catch({message:a}){b["d"].showNegative(a)}finally{e(),this.loading=!1}},async setSmsMfa(t,e){try{this.loading=!0,await Object(yt["u"])("phone_number",this.smsVerifyCodeVM.value),await b["b"].setMfaType(this.mfaType),b["d"].showPositive("changed"),this.showSmsDialog=!1,this.showSetMfaTypeDialog=!1}catch({message:a}){b["d"].showNegative(a)}finally{e(),this.loading=!1}},async setTotpMfa(t,e){try{this.loading=!0,await Object(yt["q"])(this.totpVerifyCodeVM.value),await b["b"].setMfaType(this.mfaType),b["d"].showPositive("changed"),this.showTotpDialog=!1,this.showSetMfaTypeDialog=!1}catch({message:a}){b["d"].showNegative(a)}finally{e(),this.loading=!1}},async setupTotp(){this.loading=!0,this.totpSecretCode=await Object(yt["p"])(),this.$nextTick(this.renderQRCode),this.loading=!1},async copyCode(){await navigator.clipboard.writeText(this.totpSecretCode),b["d"].showPositive("clipboard_with_code")},renderQRCode(){if(!this.totpSecretCode)return;const t=this.$refs.qrcode;if(!t)return;let e="Alphabiz Account Services",a=this.$store.state.account.emailVerified?this.$store.state.account.email:e;e=encodeURIComponent(e),a=encodeURIComponent(a).replace(".","%2E");const i=encodeURIComponent(this.totpSecretCode),o=`otpauth://totp/${e}:${a}?secret=${i}&issuer=${e}`;wt.a.toCanvas(t,o,(t=>{if(t)throw t}))}}},Ct=$t,Dt=(a("4c49"),a("9f0a")),St=Object(u["a"])(Ct,_t,bt,!1,null,"1a1edb70",null),Mt=St.exports;g()(St,"components",{QBtn:h["a"],QOptionGroup:Dt["a"]});var xt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-btn",{staticClass:"normal-grey q-mt-xs q-mr-sm text-red",staticStyle:{"min-width":"120px"},attrs:{padding:"8px",flat:"",label:t.$t("account_delete_account")},on:{click:function(e){t.showDeleteAccountDialog=!t.showDeleteAccountDialog}}},[a("setting-dialog",{attrs:{title:t.$t("account_delete_account")},on:{submit:t.deleteAccount},model:{value:t.showDeleteAccountDialog,callback:function(e){t.showDeleteAccountDialog=e},expression:"showDeleteAccountDialog"}},[a("template",{slot:"description"},[a("div",{staticStyle:{width:"309px"}},[t._v("\n        "+t._s(t.$t("account_tip_confirm_delete_account"))+"\n      ")])]),a("template",{slot:"default"},[a("alphabiz-input",{staticClass:"q-pt-md",attrs:{autofocus:"",required:"",type:"password",readonly:t.loading,label:t.$t(t.verifyPasswordVM.label),icon:t.verifyPasswordVM.icon},model:{value:t.verifyPasswordVM.value,callback:function(e){t.$set(t.verifyPasswordVM,"value",e)},expression:"verifyPasswordVM.value"}})],1)],2)],1)},qt=[],kt={name:"SecurityDeleteAccount",components:{SettingDialog:ht,AlphabizInput:M["c"]},data(){return{loading:!1,showDeleteAccountDialog:!1,verifyPasswordVM:{value:"",label:"account_password",icon:"lock"}}},watch:{showDeleteAccountDialog(t){this.loading=!t,t||(this.verifyPasswordVM.value="")}},methods:{deleteAccount(t,e){this.loading=!0;const a=()=>{e(),this.loading=!1};b["b"].deleteUser(this.verifyPasswordVM.value).then((()=>{this.showDeleteAccountDialog=!1,b["d"].showPositive("deleted")})).then((()=>this.$router.push("/account"))).catch((({message:t})=>{b["d"].showNegative(t)})).finally(a)}}},Nt=kt,Vt=(a("15ce"),Object(u["a"])(Nt,xt,qt,!1,null,"18a37a36",null)),At=Vt.exports;g()(Vt,"components",{QBtn:h["a"]});var Pt={name:"Security",components:{SettingFragment:S,SecurityChangePassword:ft,SecurityMFA:Mt,SecurityDeleteAccount:At}},Tt=Pt,Ot=Object(u["a"])(Tt,X,Y,!1,null,null,null),Ft=Ot.exports,It=function(){var t=this,e=t.$createElement,a=t._self._c||e;return this.$store.state.account.invitationCode&&this.$store.state.account.invitationCode.length>0?a("setting-fragment",{attrs:{label:t.$t("account_invitation")}},[a("div",{staticClass:"account-setting__invitation"},[a("q-list",{staticClass:"account-setting__invitation-code-container",attrs:{bordered:"",separator:""}},[t._l(t.code,(function(e,i){return[a("q-item",{directives:[{name:"ripple",rawName:"v-ripple",value:!t.loading&&2!==e.state,expression:"!loading && item.state!==2"}],key:i,staticClass:"account-setting__invitation-code-item q-px-lg",attrs:{readonly:t.loading,clickable:!t.loading&&2!==e.state},on:{click:function(){return t.handleCodeClick(e)}}},[a("q-item-section",[a("q-item-label",{staticClass:"text-weight-bold",attrs:{overline:""}},[t._v(t._s(e.code))]),1===e.state?a("q-item-label",{attrs:{caption:""}},[t._v(t._s(e.phone))]):t._e(),1===e.state?a("q-item-label",{attrs:{caption:""}},[t._v(t._s(e.email))]):t._e()],1),a("q-item-section",{attrs:{side:""}},[a("q-badge",{attrs:{color:["green","blue","grey"][e.state],label:t.$t(["account_available","account_invited","account_used"][e.state])}})],1)],1)]}))],2)],1),a("amplify-dialog",{attrs:{title:t.$t("account_invitation"),"on-submit":t.handleInvite,"on-clear":t.handleClear},scopedSlots:t._u([{key:"description",fn:function(){return[a("div",{staticClass:"q-pb-md",staticStyle:{"max-width":"284px"}},[t._v("\n        "+t._s(t.$t("account_invitation_code_dialog_tip"))),a("span",{staticClass:"text-weight-bold"},[a("div",{staticClass:"target-code-field inline-block q-py-xs rounded-borders"},[t._v("  "+t._s(t.targetCode)+"  ")])])])]},proxy:!0},{key:"default",fn:function(e){var i=e.disable;return t._l(t.form.items,(function(e,o){return a("amplify-input",t._b({key:o,staticStyle:{width:"309px"},attrs:{label:t.$t(e.bound.label),readonly:i},model:{value:e.model,callback:function(a){t.$set(e,"model",a)},expression:"item.model"}},"amplify-input",e.bound,!1))}))}}],null,!1,3947596930),model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}})],1):t._e()},Lt=[];class Qt{constructor(t){this.code=t.invitation_code,this.state=t.invitation_state,this.date=new Date(t.production_date).toISOString(),this.phone=t.contact_phone,this.email=t.contact_email}}class zt extends F["a"]{constructor(){super({contact_email:new F["b"]("",{type:"email",icon:"email",label:"account_email"}),contact_phone:new F["b"](["86","","CN"],{type:"tel",icon:"phone",label:"account_phone_number",rules:F["e"].PhoneNumber})})}setDefault(t){var e;const a=null!==(e=I["c"][t])&&void 0!==e?e:I["c"]["en-us"],[i,o]=a.phones[0].split("-"),n=this.items.contact_phone;return n.updateModel([i,n.value[1],o]),this}}var Et={name:"Invitation",components:{SettingFragment:S,SettingDialog:ht,AlphabizInput:M["c"]},props:{loading:Boolean},data(){return{showDialog:!1,targetCode:"",form:(new zt).setDefault(this.$q.lang.getLocale().toLowerCase()),resolveCallback:null}},computed:{code(){const t=this.$store.state.account.invitationCode;return t?t.map((t=>new Qt(t))):[]}},methods:{invite(){return new Promise(((t,e)=>{const a=this.code.find((t=>0===t.state));a?(this.targetCode=a.code,this.showDialog=!0,this.resolveCallback=()=>{t()}):e("invitation_no_code")}))},handleCodeClick(t){this.loading||(1===t.state?navigator.clipboard.writeText(t.code).then((()=>b["d"].showPositive("clipboard_with_invitation_code"))):(this.targetCode=t.code,this.showDialog=!0))},async handleInvite(){const t=this.form.formData;t.code=this.targetCode;const e=t.contact_email,a=t.contact_phone[1]?`+${t.contact_phone[0]}${t.contact_phone[1]}`:null;if(a||e)try{return await b["b"].inviteCode(t.code,e,a),b["d"].showPositive("invitation_code_sent"),!0}catch({message:i}){b["d"].showNegative(i)}else b["d"].showNegative("invitation_channel_required")},handleClear(){this.form.clearData().setDefault(this.$q.lang.getLocale().toLowerCase()),this.resolveCallback&&this.resolveCallback()}}},jt=Et,Bt=(a("fa30"),Object(u["a"])(jt,It,Lt,!1,null,"40ffb1ae",null)),Rt=Bt.exports;g()(Bt,"components",{QList:E["a"],QItem:j["a"],QItemSection:B["a"],QItemLabel:U["a"],QBadge:G["a"]}),g()(Bt,"directives",{Ripple:K["a"]});var Ut=function(){var t=this,e=this,a=e.$createElement,i=e._self._c||a;return i("setting-fragment",{attrs:{label:"OAuth"}},[i("q-list",{staticClass:"account-setting__oauth-manager",attrs:{bordered:"",separator:""}},e._l(e.oauthItems,(function(t){return i("q-item",{key:t.providerName},[i("q-item-section",{attrs:{top:"",avatar:""}},[i("q-item-label",{staticClass:"q-mt-sm"},[e._v(e._s(t.providerName))])],1),i("q-item-section",[i("q-item-label",{attrs:{caption:""}},[e._v(e._s(t.caption))])],1),i("q-item-section",{attrs:{top:"",side:""}},[t.linked?i("div",[i("q-btn",{attrs:{size:"12px",flat:"",round:"",icon:"delete"},on:{click:t.deleteFn}})],1):i("div",[i("q-btn",{attrs:{size:"12px",flat:"",round:"",icon:"add"},on:{click:t.addFn}})],1)])],1)})),1),e.oauthDialogData?i("amplify-dialog",{attrs:{title:e.oauthDialogData.title,"on-submit":e.oauthDialogData.onSubmit,"on-clear":function(){return t.oauthDialogData=null}},model:{value:e.showOAuthDialog,callback:function(t){e.showOAuthDialog=t},expression:"showOAuthDialog"}},[i("div",[e._v(e._s(e.oauthDialogData.description))])]):e._e()],1)},Gt=[],Jt=(a("e01a"),a("bf82")),Kt={name:"OAuthManager",components:{SettingFragment:S},props:{loading:Boolean},data(){return{oauthProviders:["Facebook","Google","Github"],showOAuthDialog:!1,oauthDialogData:null}},computed:{oauthItems(){const t=this.oauthProviders.reduce(((t,e)=>{const a=()=>this.handleAddClick(e);return t[e]={linked:!1,providerName:e,caption:"none",addFn:a},t}),{});if(this.$store.state.account.identities){const e=this.$store.state.account.identities.reduce(((t,e)=>{const a=()=>this.handleDeleteClick(e.providerName);return t[e.providerName]={linked:!0,providerName:e.providerName,caption:e.userId,deleteFn:a},t}),{});return{...t,...e}}return t}},methods:{async handleDeleteClick(t){this.oauthDialogData={title:this.$t("account_unlink_your_social_account"),description:this.$t("account_tip_confirm_unlink",{provider:t}),onSubmit:()=>this.unlink(t)},this.showOAuthDialog=!0},async handleAddClick(t){this.$store.state.account.email&&this.$store.state.account.emailVerified?(this.oauthDialogData={title:this.$t("account_link_your_social_account"),description:this.$t("account_tip_confirm_link",{provider:t}),linkResult:null,onSubmit:()=>this.link(t)},this.showOAuthDialog=!0):b["d"].showNegative("error_can_not_link_before_email_verified")},async link(t){return this.oauthDialogData.description=this.$t("account_tip_linking"),await Jt["a"].launchOAuth("signedIn",{provider:t}),this.oauthDialogData.linkResult=null,await this.waitForLinkResult(),!0},async waitForLinkResult(){let t;await new Promise((e=>{t=setInterval((()=>{null===this.oauthDialogData.linkResult||e()}),1e3)})).finally((()=>{t&&clearInterval(t)}))},async handleLinkResult(t){t.verify&&t.verify(this.$store.state.account.email),t.error?b["d"].showNegative(t.error):(await b["b"].redirectToIndex(),b["d"].showPositive("linked")),this.oauthDialogData.linkResult=t},async unlink(t){try{this.oauthDialogData.description=this.$t("account_tip_unlinking"),await b["b"].unlinkOAuth(t),b["d"].showPositive("unlinked")}catch(e){b["d"].showNegative(e.message)}return!0}}},Wt=Kt,Ht=(a("2d0e"),Object(u["a"])(Wt,Ut,Gt,!1,null,null,null)),Xt=Ht.exports;g()(Ht,"components",{QList:E["a"],QItem:j["a"],QItemSection:B["a"],QItemLabel:U["a"],QBtn:h["a"]});var Yt={name:"AccountSettings.vue",components:{OptionalInformation:P,VerificationFields:H,OAuthManager:Xt,Security:Ft,Invitation:Rt},data(){return{loading:!1}},mounted(){this.$route.query.call&&this.invite()},watch:{"$route.query.call"(t){t&&this.invite()}},methods:{setLoading(t){this.loading=t},invite(){if(this.loading)return;const t=this.$refs.invitation;t.invite().then((()=>{this.$router.push({path:this.$route.path,query:{}})}))}}},Zt=Yt,te=(a("a404"),a("9989")),ee=Object(u["a"])(Zt,i,o,!1,null,null,null);e["default"]=ee.exports;g()(ee,"components",{QPage:te["a"]})},"2d0e":function(t,e,a){"use strict";a("ec18")},"464b":function(t,e,a){},"4c49":function(t,e,a){"use strict";a("18a0")},"5be0":function(t,e,a){"use strict";a("80d5")},"6a0b":function(t,e,a){},"6ea8":function(t,e,a){"use strict";a("8dec")},"762d":function(t,e,a){},"80d5":function(t,e,a){},"8dec":function(t,e,a){},a404:function(t,e,a){"use strict";a("464b")},a71e:function(t,e,a){},bc783:function(t,e,a){},d226:function(t,e,a){},d98f:function(t,e,a){"use strict";a("bc783")},e8f1:function(t,e,a){},ec18:function(t,e,a){},fa30:function(t,e,a){"use strict";a("6a0b")}}]);