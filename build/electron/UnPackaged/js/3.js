(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"04c6":function(t,e,s){"use strict";s("9242")},"064b":function(t,e,s){},"129a":function(t,e,s){},"14ff":function(t,e,s){},"3e63":function(t,e,s){"use strict";s("e0f6")},5930:function(t,e,s){},7255:function(t,e,s){"use strict";s("129a")},"755b":function(t,e,s){"use strict";s("14ff")},"8b24":function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{staticClass:"flex",nativeOn:{paste:function(e){return t.onPaste.apply(null,arguments)}}},[s("div",{staticClass:"container"},[s("input",{ref:"folderSelector",staticStyle:{display:"none"},attrs:{type:"file",name:"folder-selector",id:"folder-selector",webkitdirectory:""},on:{change:t.selectFolder}}),s("q-page-sticky",{attrs:{position:"bottom-right",offset:[16,16]}},t._l({download:{tabName:"downloading",color:"primary",icon:"add",handleClick:function(){return t.showMagnetDialog("download")}},upload:{tabName:"uploading",color:"primary",icon:"cloud_upload",handleClick:function(){return t.showMagnetDialog("upload")}},upload_all:{tabName:"downloaded",color:"primary",icon:"cloud_upload",handleClick:t.uploadAll}},(function(e,o){return s("alphabiz-button",{directives:[{name:"show",rawName:"v-show",value:t.currentTab===e.tabName,expression:"currentTab === buttonData.tabName"}],key:o,staticClass:"q-ma-xs",attrs:{color:e.color,icon:e.icon,label:t.$t(o),"button-type":"fab"},on:{click:e.handleClick}})})),1),s("div",{staticClass:"sticky-bar q-py-sm bg-page text-page q-header--bordered"},[s("q-toolbar",{staticClass:"sticky-bar-toolbar"},[t._l([{tabName:"downloading",label:"start_all",color:"primary",handleClick:t.downloadAll},{tabName:"downloading",label:"pause_all",color:"general",handleClick:t.pauseAllDownloading},{tabName:"downloading",label:"remove_all",color:"negative",handleClick:t.removeAllDownloading},{tabName:"uploading",label:"pause_all",color:"general",handleClick:t.pauseAllUploading},{tabName:"uploading",label:"remove_all",color:"negative",handleClick:t.removeAllUploading},{tabName:"downloaded",label:"clear_history",color:"general",handleClick:t.clearAll}],(function(e,o){return s("alphabiz-button",{directives:[{name:"show",rawName:"v-show",value:t.currentTab===e.tabName,expression:"currentTab === buttonData.tabName"}],key:o,attrs:{color:e.color,icon:e.icon,label:t.$t(e.label)},on:{click:e.handleClick}})})),s("q-space"),s("alphabiz-button",{attrs:{"button-type":"icon",icon:"search"},on:{click:function(e){return t.toggleSearchText(!0)}}}),s("q-input",{directives:[{name:"show",rawName:"v-show",value:t.showSearchText||t.searchText.length,expression:"showSearchText || searchText.length"}],ref:"searchInput",attrs:{dense:"",borderless:"",filled:"",type:"text",debounce:"300"},on:{blur:function(e){return t.toggleSearchText(!1)}},nativeOn:{paste:function(e){return e.stopPropagation(),e.preventDefault(),t.pasteSearchText.apply(null,arguments)}},scopedSlots:t._u([{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer text-red",attrs:{name:"close"},on:{click:t.clearSearch}})]},proxy:!0}]),model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}}),s("alphabiz-button",{attrs:{"button-type":"icon",icon:"list"===t.listMode?"view_list":"view_agenda"},on:{click:t.changeListMode}},[s("q-tooltip",[t._v(t._s(t.$t("toggle_list_mode")))])],1),s("q-select",{staticStyle:{width:"148px",display:"inline-block"},attrs:{dense:"",options:t.sortOptions,label:t.$t("sort"),"emit-value":"","map-options":""},model:{value:t.sortOption,callback:function(e){t.sortOption=e},expression:"sortOption"}}),s("alphabiz-button",{attrs:{"button-type":"icon",icon:1===t.sortSequence?"arrow_upward":"arrow_downward"},on:{click:t.changeSortSequence}},[s("q-tooltip",[t._v(t._s(1===t.sortSequence?t.$t("ascending"):t.$t("descending")))])],1)],2),"downloading"===t.currentTab?s("q-toolbar",{staticClass:"sticky-bar-toolbar",staticStyle:{"min-height":"unset"}},[s("q-linear-progress",{attrs:{value:t.downloadingProgress.value,rounded:"",color:"primary","track-color":"grey",size:"20px"}},[s("div",{staticClass:"absolute-full flex flex-center"},[s("q-badge",{staticClass:"badge",attrs:{color:"transparent",label:t.downloadingProgress.label}})],1)]),s("div",{staticClass:"download-speed"},[t._v(t._s(t.totalDownloadSpeed))])],1):t._e(),"uploading"===t.currentTab?s("q-toolbar",{staticClass:"sticky-bar-toolbar",staticStyle:{"min-height":"unset"}},[s("div",[t._v(t._s(t.totalIncomeInfo))]),s("q-space"),s("div",[t._v(t._s(t.$t("total_upload_speed"))+": "+t._s(t.totalUploadSpeed))])],1):t._e()],1),s("q-tab-panels",{staticClass:"torrent-list bg-transparent",class:{"torrent-list-large":"downloaded"!==t.currentTab},model:{value:t.displayTab,callback:function(e){t.displayTab=e},expression:"displayTab"}},t._l(t.displayList,(function(e){return s("q-tab-panel",{key:"panel_"+e.label,staticClass:"q-px-none q-mt-none q-pa-none",attrs:{name:e.key}},[s(t.listComponent,{key:"task-list-"+e.label,tag:"component",attrs:{list:e,tab:t.currentTab,incomes:t.incomes,noDataMessage:t.noDataMessage},on:{pauseTorrent:t.pauseTorrent,resumeTorrent:t.resumeTorrent,deleteTorrent:t.deleteTorrent,play:t.play,showOriginTorrent:t.showOriginTorrent,showDirectory:t.showDirectory,setThrottleGroup:t.setThrottleGroup,saveTorrentFile:t.saveTorrentFile,showPaymentPannel:t.showPaymentPannel,showDetail:t.showDetail,showAbPanel:t.showAbPanel}})],1)})),1)],1),s("q-dialog",{model:{value:t.magnetDialog,callback:function(e){t.magnetDialog=e},expression:"magnetDialog"}},[s("q-card",{staticStyle:{width:"400px","max-width":"80vw","overflow-x":"hidden"}},[s("q-card-section",["download"===t.mode?s("q-tabs",{staticClass:"text-primary",attrs:{"no-caps":""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[s("q-tab",{attrs:{name:"magnet",label:this.$t("link_task")}}),s("q-tab",{attrs:{name:"torrent",label:this.$t("torrent_task")}})],1):s("div",{staticClass:"upload-title text-primary text-center q-mt-sm q-mb-md text-subtitle2"},[t._v("\n            "+t._s(t.$t("upload"))+"\n          ")])],1),s("q-card-section",{staticClass:"q-pt-none"},["magnet"===t.tab&&"download"===t.mode?s("q-input",{staticClass:"q-py-sm",attrs:{dense:"",autofocus:""},model:{value:t.magnetUrl,callback:function(e){t.magnetUrl=e},expression:"magnetUrl"}}):t._e(),"torrent"===t.tab||"upload"===t.mode?s("q-file",{attrs:{filled:"",label:"download"===t.mode?this.$t("torrent_file"):this.$t("file"),accept:"download"===t.mode?".torrent":""},scopedSlots:t._u(["upload"===t.mode?{key:"append",fn:function(){return[s("q-btn",{attrs:{flat:""},on:{click:t.showSelectFolder}},[s("IconWithTooltip",{attrs:{icon:"folder",tooltip:t.$t("folder")}})],1)]},proxy:!0}:null],null,!0),model:{value:t.torrentFile,callback:function(e){t.torrentFile=e},expression:"torrentFile"}}):t._e(),s("div",{staticClass:"configuration-variable q-pt-sm"},[s("q-input",{directives:[{name:"show",rawName:"v-show",value:"download"===t.mode,expression:"mode === 'download'"}],staticStyle:{width:"100%"},attrs:{label:this.$t("download_directory_position")},on:{click:t.select_directory},model:{value:t.settings.downloadDirectory,callback:function(e){t.$set(t.settings,"downloadDirectory",e)},expression:"settings.downloadDirectory"}})],1)],1),s("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:this.$t("cancel")}}),s("q-btn",{attrs:{flat:"",label:"download"===t.mode?this.$t("download"):this.$t("upload")},on:{click:t.submit}})],1)],1)],1),s("torrent-payment",t._b({attrs:{show:t.showPayment,autoRenew:t.autoRenew},on:{change:function(e){return t.showPayment=e},createPayment:t.createPayment,setAutoRenew:t.setAutoRenew}},"torrent-payment",t.paymentData,!1)),s("TableListDetail",{attrs:{show:t.showTorrentDetail,torrent:t.torrentDetail},on:{close:t.hideDetail,showDirectory:t.showDirectory,showPaymentPannel:t.showPaymentPannel,play:t.play}}),s("AlphabizPanel",{attrs:{show:t.showAlphabizPanel,torrent:t.alphabizTorrent,paymentSize:t.paymentSize},on:{close:t.hideAbPanel,createPayment:t.createPayment,setAutoRenew:t.setAutoRenew}})],1)},i=[],n=(s("5319"),s("ddb0"),s("4069"),s("a79d"),s("e9c4"),s("0c6d")),a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-virtual-scroll",{key:"torrent-list-"+t.list.label,staticClass:"q-pt-md",staticStyle:{"max-height":"calc(100vh - 83px)"},attrs:{items:t.list.list},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.item;return[s("q-item",{key:o.infoHash,staticClass:"fit",attrs:{dense:""}},[s("card-item",{attrs:{torrent:o},on:{pauseTorrent:t.emitEvent["pauseTorrent"],resumeTorrent:t.emitEvent["resumeTorrent"],deleteTorrent:t.emitEvent["deleteTorrent"],play:t.emitEvent["play"],showOriginTorrent:t.emitEvent["showOriginTorrent"],showDirectory:t.emitEvent["showDirectory"],setThrottleGroup:t.emitEvent["setThrottleGroup"],saveTorrentFile:t.emitEvent["saveTorrentFile"],showPaymentPannel:t.emitEvent["showPaymentPannel"],showDetail:t.emitEvent["showDetail"],showAbPanel:t.emitEvent["showAbPanel"]}})],1)]}},{key:"after",fn:function(){return[t.list.list.length?t._e():s("div",{staticClass:"full-width text-center text-subtitle1"},[s("q-icon",{attrs:{name:"help_outline"}}),t._v("\n        "+t._s(t.noDataMessage)+"\n      ")],1)]},proxy:!0}])})},r=[],l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{width:"100%"}},[s("q-card",{staticClass:"torrent-item",attrs:{flat:"",bordered:""}},[s("q-card-section",[s("div",{staticClass:"row justify-between items-center"},[s("div",{staticClass:"torrent-info title q-mb-xs"},[s("p",{staticClass:"torrent-name"},[t.isReady?t._e():s("q-circular-progress",{directives:[{name:"show",rawName:"v-show",value:!t.torrent.paused&&!t.torrent.pending,expression:"!torrent.paused && !torrent.pending"}],staticClass:"torrent-loading",attrs:{indeterminate:"",size:"24px",color:"primary"}}),s("span",[t._v(t._s(t.displayName))]),t.torrent.isAutoUpload?s("q-icon",{staticClass:"q-ml-md",attrs:{name:"drive_folder_upload"}},[s("q-tooltip",[t._v(t._s(t.$t("auto_uploading")))])],1):t._e()],1)]),s("alphabiz-button",{staticClass:"absolute-top-right q-mt-sm q-mr-md",attrs:{size:"md","button-type":"icon",icon:"more_horiz"},on:{click:t.showDetail}},[s("q-tooltip",[t._v(t._s(t.$t("more")))])],1)],1),s("div",{staticClass:"torrent-info"},[s("div",{staticClass:"operations"},[s("alphabiz-button",{staticClass:"q-mr-sm",attrs:{color:"general",size:"sm",value:t.locked,icon:"stop",label:t.torrentAction},on:{click:t.switchStateTorrent}}),t.isReady&&t.playable?s("alphabiz-button",{staticClass:"q-mr-sm",attrs:{color:"general",size:"sm",icon:"play_arrow",label:t.torrent.done||t.torrent.isSeeding?t.$t("play"):t.$t("play_while_downloading")}},[s("q-menu",[s("q-list",{staticStyle:{"min-width":"100px"}},t._l(t.playableFiles,(function(e){return s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:e.name,staticClass:"playable-items",attrs:{clickable:!e.missing,disable:e.missing},on:{click:function(s){return t.play(e.path,t.torrent.infoHash)}}},[s("q-linear-progress",{directives:[{name:"show",rawName:"v-show",value:1!==e.progress||e.isSeeding,expression:"item.progress !== 1 || item.isSeeding"}],staticClass:"progress-background",attrs:{stripe:"",value:e.progress,color:"primary"}}),s("q-item-section",[s("p",{staticClass:"q-ma-none"},[s("q-icon",{staticClass:"q-mr-xs",attrs:{name:"play_arrow"}}),t._v("\n                      "+t._s(e.name)+"\n                      "),e.missing?s("q-icon",{attrs:{name:"error",color:"primary"}}):1===e.progress?s("q-icon",{attrs:{name:"done",color:"primary"}}):t._e(),e.missing?s("q-tooltip",[t._v(t._s(t.$t("file_not_found")))]):t._e()],1)])],1)})),1)],1)],1):t._e(),s("alphabiz-button",{staticClass:"q-mr-sm",attrs:{color:"general",size:"sm",icon:"folder",label:t.$t("open_directory")},on:{click:t.showDirectory}}),s("alphabiz-button",{staticClass:"q-mr-sm",attrs:{color:"negative",size:"sm",label:t.$t("delete")},on:{click:t.deleteTorrent}}),s("q-space"),t.showAbButton?s("q-btn",{staticClass:"text-primary",attrs:{size:"sm"},on:{click:t.openAbPanel}},[s("IconWithTooltip",{attrs:{icon:t.isPayed?"flash_auto":"flash_on",tooltip:t.isPayed?t.$t("alphabiz_accelerating"):t.$t("ab_peer_available")}})],1):t._e()],1),t.torrent.upload||t.torrent.isSeeding?t._e():s("q-linear-progress",{staticClass:"q-mt-md",attrs:{value:t.torrent.done?1:t.torrent.progress,size:"18px",rounded:""}},[s("div",{staticClass:"progress-text flex flex-center absolute-full"},[t._v(t._s(t.progress))])]),s("p",{staticClass:"text q-mb-xs"},[t.statusText?s("span",{staticClass:"hint status-text"},[s("small",[t._v(t._s(t.statusText))]),s("br")]):t._e(),s("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(this.$t("status"))+": "+t._s(t.torrentStatus))]),t.torrent.paused||t.torrent.done||t.torrent.pending||t.torrent.isSeeding?t._e():s("span",[t._v(t._s(t.downloadSpeed))]),t.torrent.upload?s("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(t.total))]):s("span",{staticStyle:{"margin-right":"10px"}},[t._v("↓ "+t._s(t.downloaded)+" / "+t._s(t.total))]),t.torrent.paused||t.torrent.done||t.torrent.pending?t._e():s("span",[t._v(t._s(t.uploadSpeed))]),s("span",{staticStyle:{"margin-right":"10px"}},[t._v("↑ "+t._s(t.uploaded))])]),s("p",{staticClass:"text timers q-mt-xs"},[t.torrent.timeRemaining&&t.torrent.download?s("span",{staticClass:"remaining q-mr-md"},[t._v(t._s(t.$t("remaining"))+": "+t._s(t.remaining))]):t._e(),t.createdTime?s("span",[t._v(t._s(t.$t("created_time")+": "+t.createdTime))]):t._e(),t.completedTime?s("span",{staticClass:"q-ml-md"},[t._v(t._s(t.$t("completed_time")+": "+t.completedTime))]):t._e(),t.usedTime?s("span",{staticClass:"q-ml-md"},[t._v(t._s(t.$t("used_time")+": "+t.usedTime))]):t._e()])],1)])],1),s("q-dialog",{model:{value:t.showPeers,callback:function(e){t.showPeers=e},expression:"showPeers"}},[s("q-card",{staticStyle:{width:"400px","max-width":"80vw"}},[s("q-card-section",[s("div",{staticClass:"text-h6"},[t._v("Peers")])]),t._l(t.connectedPeers,(function(e){return s("q-field",{key:e.id,staticClass:"q-mx-md q-my-xs",attrs:{"stack-label":"",borderless:"",readonly:"",label:e.id},scopedSlots:t._u([{key:"prepend",fn:function(){return[e.isAbPeer?"high"===e.level?s("q-icon",{attrs:{name:"done_all"}},[s("q-tooltip",[t._v(t._s(t.$t("ab_peer_verified")))])],1):s("q-icon",{attrs:{name:"done"}},[s("q-tooltip",[t._v(t._s(t.$t("ab_peer")))])],1):s("q-icon",{attrs:{name:"remove"}},[s("q-tooltip",[t._v(t._s(t.$t("common_peer")))])],1)]},proxy:!0},{key:"control",fn:function(){return[t._l(e.addresses,(function(o){return s("div",{key:e.id+"_"+o,staticClass:"self-center full-width not-outline"},[t._v(t._s(o))])})),e.isAbPeer?[s("div",{staticClass:"text full-width text-primary q-mt-xs"},[t._v("Upload speed throttle group:")]),s("q-btn-toggle",{attrs:{dense:"",stretch:"",options:t.levelOptions},on:{input:function(s){return t.setThrottleGroup(e.id,e.remoteSubId,s)}},model:{value:e.level,callback:function(s){t.$set(e,"level",s)},expression:"item.level"}}),s("div",{staticClass:"full-width"},[s("span",{staticClass:"peer-speed q-ml-xs"},[t._v("↑ "+t._s(t.byteToLargerSize(e.uploadSpeed))+" / s")]),s("span",{staticClass:"peer-speed q-ml-md"},[t._v("↓ "+t._s(t.byteToLargerSize(e.downloadSpeed))+" / s")])]),t.torrent.download&&t.torrent.progress<1&&e.subId?[s("div",{staticClass:"text full-width text-primary q-mt-xs"},[t._v("Download Payment")]),s("q-btn",{attrs:{dense:"",color:"primary",label:" PAY "},on:{click:function(s){return t.showPaymentPannel(e)}}})]:t._e()]:s("div",{staticClass:"q-mt-xs"},[s("span",{staticClass:"peer-speed q-ml-xs"},[t._v("↑ "+t._s(t.byteToLargerSize(e.uploadSpeed))+" / s")]),s("span",{staticClass:"peer-speed q-ml-md"},[t._v("↓ "+t._s(t.byteToLargerSize(e.downloadSpeed))+" / s")])])]},proxy:!0}],null,!0)})})),t.torrent.connections?t._e():s("q-card-section",[t._v("No connected peer available")])],2)],1)],1)},d=[],c=s("307e"),h=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-icon",{class:{"cursor-pointer":t.clickable},attrs:{name:t.icon},on:{click:t.emitClick}},[t.tooltip?s("q-tooltip",[t._v("\n    "+t._s(t.tooltip)+"\n  ")]):t._e()],1)},p=[],u={name:"IconWithTooltip",props:{icon:{type:String,require:!0},tooltip:{type:String,default:""},clickable:{type:Boolean,default:!1}},methods:{emitClick(){this.$emit("click")}}},m=u,g=s("2877"),b=s("0016"),f=s("05c0"),y=s("eebe"),_=s.n(y),w=Object(g["a"])(m,h,p,!1,null,null,null),v=w.exports;let T;_()(w,"components",{QIcon:b["a"],QTooltip:f["a"]});try{T=s("34bb").clipboard}catch(le){T=navigator.clipboard}var $={name:"CardItem",props:{torrent:{type:Object,required:!0},statusText:String},components:{IconWithTooltip:v},data(){return{showPeers:!1,levelOptions:[{label:" Low ",value:"low"},{label:" Middle ",value:"mid"},{label:" High ",value:"high"}],locked:!1,loading:!1}},computed:{torrentAction(){return this.torrent.paused?this.torrent.completed?this.$t("seed"):this.$t("resume"):this.torrent.isSeeding?this.$t("stop_torrent"):this.$t("pause")},isReady(){return this.torrent&&this.torrent.name&&this.torrent.length},downloadSpeed(){return this.byteToLargerSize(this.torrent.downloadSpeed)+"/s"},downloaded(){return this.byteToLargerSize(this.torrent.downloaded)},uploadSpeed(){return this.byteToLargerSize(this.torrent.uploadSpeed)+"/s"},uploaded(){return this.byteToLargerSize(this.torrent.uploaded)},total(){return this.byteToLargerSize(this.torrent.length)},remaining(){return!this.torrent.timeRemaining||this.torrent.paused?"-":this.msToTime(this.torrent.timeRemaining)},createdTime(){return this.torrent.createdTime?new Date(this.torrent.createdTime).toLocaleString(this.$i18n.locale,{hour12:!1}):""},completedTime(){return this.torrent.completedTime?new Date(this.torrent.completedTime).toLocaleString(this.$i18n.locale,{hour12:!1}):""},usedTime(){return this.torrent.usedTime?this.msToTime(this.torrent.usedTime):""},torrentStatus(){return this.torrent.missFile?this.$t("miss_file"):this.paused?this.$t("paused"):this.torrent.paused?this.torrent.done||this.torrent.isSeeding?this.$t("completed"):this.$t("paused"):this.torrent.isSeeding?this.$t("seeding"):this.torrent.upload?this.$t("uploading"):this.torrent.pending?this.$t("pending"):this.torrent.hasMetadata&&!this.torrent.ready?this.$t("verifying"):!1===this.torrent.ready?this.$t("file_loading"):this.torrent.download?this.torrent.done?this.$t("downloaded"):this.$t("downloading"):this.loading?this.$t("loading"):this.$t("unknown_status")},displayName(){const t=this.torrent.name||this.torrent.origin||this.torrent.token;if(!t)return"";if(t.includes("&dn")){const e=(t+"&").match(/&dn=(.*?)&/);if(e&&e[1])return e[1]}const e=t.match(/btih:([^&]*)/);if(e&&e[1])return e[1];if(t.includes("/")||t.includes("\\")){const e=t.replace(/(\\|\/)$/,"").match(/([^\\/]*$)/);if(e&&e[1])return e[1]}return t},progress(){const t=this.torrent.progress>.9999?.9999:this.torrent.progress;return parseFloat((100*t).toFixed(2))+"%"},showAbButton(){var t;return!this.torrent.done&&!this.torrent.isSeeding&&(null===(t=this.torrent.connections)||void 0===t?void 0:t.some((t=>t.isAbPeer&&t.subId&&t.subId!==this.$store.getters.accountUserInfo.sub)))},payedConnections(){var t;return null===(t=this.torrent.connections)||void 0===t?void 0:t.filter((t=>"high"===t.remoteGroup))},isPayed(){return this.payedConnections.length},showAbPeerHint(){return!(!this.torrent||!this.torrent.connections||this.torrent.isSeeding)&&this.torrent.connections.some((t=>t.isAbPeer))},connectedPeers(){if(!this.torrent||!this.torrent.connections)return[];const t={};for(const e of this.torrent.connections){const s=e.subId||e.id;t[s]?t[s].isAbPeer|=e.isAbPeer:(t[s]=e,t[s].addresses=[]),t[s].addresses.includes(e.address)||t[s].addresses.push(e.address)}return Object.values(t).sort(((t,e)=>t.id.localeCompare?t.id.localeCompare(e.id):0))},playableFiles(){return this.torrent.files.filter((t=>Object(c["a"])(t.name)))},playable(){return this.playableFiles.length}},methods:{byteToLargerSize(t){if("number"!==typeof t)return"0";const e=navigator.userAgent.includes("Windows")?1024:1e3;if(t<e)return t.toFixed(2)+" Byte";const s=(t/e).toFixed(2);if(s<e)return s+" KB";const o=(s/e).toFixed(2);return o<e?o+" MB":(o/e).toFixed(2)+" GB"},msToTime(t){const e=Math.floor(t/1e3),s=e%60,o=(e-s)/60;if(isNaN(s))return"-";if(o>60){const t=o%60,e=(o-t)/60;return e>24?"> 24h":`${e}:${("0"+t).slice(-2)}:${("0"+s).slice(-2)}`}return`${("0"+o).slice(-2)}:${("0"+s).slice(-2)}`},deleteTorrent(){this.$emit("deleteTorrent",this.torrent)},switchStateTorrent(){this.locked||(this.locked=!0,setTimeout((()=>{this.locked=!1}),500),this.torrent.paused?this.$emit("resumeTorrent",this.torrent):this.$emit("pauseTorrent",this.torrent.infoHash||this.torrent.token||this.token.origin))},showPeerDialog(){this.showPeers=!0},openAbPanel(){console.log("open"),this.$emit("showAbPanel",this.torrent)},showDetail(){this.$emit("showDetail",this.torrent)},setThrottleGroup(t,e,s){this.$emit("setThrottleGroup",{infoHash:this.torrent.infoHash,id:t,subId:e,level:s})},saveTorrentFile(){this.$emit("saveTorrentFile",this.torrent.infoHash)},play(t,e){this.$emit("play",t,e)},copyMagnetURI(){let t=this.torrent.alphabizURI||this.torrent.magnetURI;t||(t="magnet:?xt=urn:btih:"+this.torrent.infoHash,this.torrent.name&&(t+="&dn="+encodeURIComponent(this.torrent.name))),T.writeText(t),this.$q.notify(this.$t("text_copied"))},showOriginTorrent(){this.$emit("showOriginTorrent",this.torrent)},showDirectory(){this.$emit("showDirectory",this.torrent)},showPaymentPannel(t){this.$emit("showPaymentPannel",{infoHash:this.torrent.infoHash,torrentName:this.torrent.name,peerId:t.id,address:t.address,remoteUser:t.user,remoteSubId:t.subId})}},watch:{torrentStatus(t,e){e!==t&&this.$emit("sortByStatus")}},mounted(){this.loading=this.torrent.loading}},S=$,x=(s("9f74"),s("f09f")),q=s("a370"),k=s("58ea"),C=s("4e73"),I=s("1c1c"),P=s("66e5"),D=s("6b1d"),A=s("4074"),O=s("2c91"),H=s("9c40"),F=s("24e8"),Q=s("8572"),L=s("6a67"),z=s("b498"),R=s("7f67"),N=Object(g["a"])(S,l,d,!1,null,"11202aa6",null),E=N.exports;_()(N,"components",{QCard:x["a"],QCardSection:q["a"],QCircularProgress:k["a"],QIcon:b["a"],QTooltip:f["a"],QMenu:C["a"],QList:I["a"],QItem:P["a"],QLinearProgress:D["a"],QItemSection:A["a"],QSpace:O["a"],QBtn:H["a"],QDialog:F["a"],QField:Q["a"],QBtnToggle:L["a"],QColor:z["a"]}),_()(N,"directives",{ClosePopup:R["a"]});var j={name:"CardList",props:{list:Object,noDataMessage:String},data(){const t=this;return{emitEvent:new Proxy({},{get(e,s){return(...e)=>{t.$emit(s,...e)}}})}},components:{CardItem:E}},U=j,W=(s("04c6"),s("a12b")),M=Object(g["a"])(U,a,r,!1,null,"5ea2c7a0",null),B=M.exports;_()(M,"components",{QVirtualScroll:W["a"],QItem:P["a"],QIcon:b["a"]});var G=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-table",{staticClass:"list bg-page text-page",attrs:{data:t.list.list,columns:t.columns,"row-key":"name",dense:"","virtual-scroll":"","hide-bottom":!!t.list.list.length,"rows-per-page-options":[0],"visible-columns":t.visibleColumns,"no-data-label":t.noDataMessage},nativeOn:{mousemove:function(e){return t.onDrag(e)},mouseleave:function(e){return t.onDragEnd.apply(null,arguments)},mouseup:function(e){return t.onDragEnd.apply(null,arguments)}},scopedSlots:t._u([{key:"header",fn:function(e){return[s("q-tr",{attrs:{props:e}},t._l(e.cols,(function(o){return s("q-th",{key:o.name,staticClass:"thead",attrs:{props:e}},[s("span",{staticClass:"text-ellipsis"},[t._v(t._s(o.label))]),"options"!==o.name?s("span",{staticClass:"thead-dragable",on:{mousedown:function(e){return t.onDragStart(o,e)},mouseup:t.onDragEnd}},[t._v("|")]):t._e()])})),1)]}},{key:"body",fn:function(e){return[s("ListItem",{attrs:{torrent:e.row,visibleColumns:t.visibleColumns,showCols:t.showCols,incomes:t.taskIncomes[e.row.infoHash],colWidth:t.colWidthText},on:{pauseTorrent:t.emitEvent["pauseTorrent"],resumeTorrent:t.emitEvent["resumeTorrent"],deleteTorrent:t.emitEvent["deleteTorrent"],play:t.emitEvent["play"],showOriginTorrent:t.emitEvent["showOriginTorrent"],showDirectory:t.emitEvent["showDirectory"],setThrottleGroup:t.emitEvent["setThrottleGroup"],saveTorrentFile:t.emitEvent["saveTorrentFile"],showPaymentPannel:t.emitEvent["showPaymentPannel"],showDetail:t.emitEvent["showDetail"],showAbPanel:t.emitEvent["showAbPanel"]}})]}},{key:"no-data",fn:function(){return[s("div",{staticClass:"full-width text-center text-subtitle1"},[s("q-icon",{attrs:{name:"help_outline"}}),t._v("\n      "+t._s(t.noDataMessage)+"\n    ")],1)]},proxy:!0}])})},J=[],Y=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-tr",{key:t.torrent.infoHash||t.torrent.origin,staticClass:"list-item-tr"},[s("q-td",{key:"name",staticClass:"no-select task-name",style:t.colWidth.name,on:{dblclick:t.onDoubleClick}},[s("IconWithTooltip",t._b({staticClass:"q-mr-xs name-icon"},"IconWithTooltip",t.taskIcon,!1)),s("div",{staticClass:"name-info"},[s("span",{staticClass:"torrent-name",attrs:{title:t.displayName}},[t._v(t._s(t.displayName))]),s("br"),t.torrent.isAutoUpload?s("IconWithTooltip",{staticClass:"q-mr-xs text-primary",attrs:{tooltip:t.$t("auto_uploading"),icon:"cloud_upload"}}):t._e(),s("span",{staticClass:"text-grey"},[t._v(t._s(t.downloadStatus))])],1)],1),t.showCols["remaining"]?s("q-td",{key:"remaining",style:t.colWidth.remaining},[t._v(t._s(t.remaining))]):t._e(),t.showCols["completedTime"]?s("q-td",{key:"completedTime",style:t.colWidth.completedTime},[t._v(t._s(t.completedTime))]):t._e(),t.showCols["progress"]?s("q-td",{key:"progress",style:t.colWidth.progress},[s("q-linear-progress",{attrs:{value:t.torrent.progress,size:"24px",color:"primary"}},[s("div",{staticClass:"absolute-full flex flex-center"},[s("q-badge",{staticClass:"badge",attrs:{color:"transparent",label:t.progress}})],1)])],1):t._e(),t.showCols["uploadSpeed"]?s("q-td",{key:"uploadSpeed",style:t.colWidth.uploadSpeed},[t._v(t._s(t.uploadSpeed))]):t._e(),t.showCols["downloadSpeed"]?s("q-td",{key:"downloadSpeed",style:t.colWidth.downloadSpeed},[s("span",[t._v(t._s(t.downloadSpeed))]),t.showAbButton?s("q-btn",{staticClass:"text-primary float-right",attrs:{flat:"",dense:"",size:"sm"},on:{click:t.openAbPanel}},[s("IconWithTooltip",{attrs:{icon:t.isPayed?"flash_auto":"flash_on",tooltip:t.isPayed?t.$t("alphabiz_accelerating"):t.$t("ab_peer_available")}})],1):t._e()],1):t._e(),t.showCols["incomeInfo"]?s("q-td",{key:"incomeInfo",staticClass:"text-right",style:t.colWidth.incomeInfo},[t._v(t._s(t.incomeInfo))]):t._e(),t.visibleColumns.includes("options")?s("q-td",{key:"options",staticClass:"option-btns",style:t.colWidth.options,attrs:{"auto-width":""}},[t.torrent.isAutoUpload||t.torrent.missFile?t._e():s("q-btn",{attrs:{flat:"",dense:"",size:"sm",disable:t.locked},on:{click:t.toggleStatus}},[s("IconWithTooltip",{attrs:{icon:t.actionIcon,tooltip:t.taskAction,clickable:""}})],1),s("q-btn",{attrs:{flat:"",dense:"",size:"sm"},on:{click:t.onDoubleClick}},[s("IconWithTooltip",{attrs:{icon:"file_open",tooltip:t.$t("open_file"),clickable:""}})],1),s("q-btn",{attrs:{flat:"",dense:"",size:"sm"},on:{click:t.showDirectory}},[s("IconWithTooltip",{attrs:{icon:"folder",tooltip:t.$t("open_directory"),clickable:""}})],1),s("q-btn",{attrs:{flat:"",dense:"",size:"sm"},on:{click:t.showDetail}},[s("IconWithTooltip",{attrs:{icon:"more_horiz",tooltip:t.$t("more"),clickable:""}})],1),s("q-btn",{staticClass:"text-red",attrs:{flat:"",dense:"",size:"sm"},on:{click:t.deleteTorrent}},[s("IconWithTooltip",{attrs:{icon:"close",tooltip:t.$t("delete"),clickable:""}})],1)],1):t._e()],1)},V=[],X=s("f880"),K={name:"ListItem",props:{torrent:{type:Object,required:!0},visibleColumns:{type:Array,required:!0},showCols:{type:Object,required:!0},incomes:{type:Object,default:()=>({})},colWidth:{type:Object,default:()=>({})}},inject:["io"],components:{IconWithTooltip:v},data(){return{locked:!1}},computed:{displayName(){const t=this.torrent.name||this.torrent.origin||this.torrent.token;if(!t)return"";if(t.includes("&dn")){const e=(t+"&").match(/&dn=(.*?)&/);if(e&&e[1])return e[1]}const e=t.match(/btih:([^&]*)/);if(e&&e[1])return e[1];if(t.includes("/")||t.includes("\\")){const e=t.replace(/(\\|\/)$/,"").match(/([^\\/]*$)/);if(e&&e[1])return e[1]}return t},isReady(){return this.torrent&&this.torrent.name&&this.torrent.ready},taskIcon(){const t=Object(X["c"])(this.torrent.files.map((t=>t.path||t)));return{icon:t.icon,tooltip:this.$t(t.tooltip)}},downloadStatus(){return this.torrent.isSeeding||this.torrent.done?this.torrent.missFile?this.$t("miss_file"):this.torrent.length?Object(X["a"])(this.torrent.length):this.$t("loading"):this.torrent.done||this.torrent.downloaded===this.torrent.length?Object(X["a"])(this.torrent.length):`${Object(X["a"])(this.torrent.downloaded)}/${Object(X["a"])(this.torrent.length)}`},remaining(){return this.torrent.paused||this.torrent.pending?"-":Object(X["d"])(this.torrent.timeRemaining)},completedTime(){const t=(...t)=>this.$t(...t);return this.torrent.completedTime?Object(X["e"])(this.torrent.completedTime,t,null===this||void 0===this?void 0:this.$i18n.locale):Object(X["e"])(this.torrent.createdTime||Date.now(),t,null===this||void 0===this?void 0:this.$i18n.locale)},progress(){const t=this.torrent.progress>.9999?.9999:this.torrent.progress;return parseFloat((100*t).toFixed(2))+"%"},downloadSpeed(){return this.torrent.paused?this.$t("paused"):this.torrent.pending?this.$t("pending"):this.torrent.ready?Object(X["a"])(this.torrent.downloadSpeed,{byte:!1,gb:!1})+"/s":this.torrent.hasMetadata?this.$t("verifying"):this.$t("loading")},incomeInfo(){return[this.incomes.today||0,this.incomes.total||0].join(" / ")},uploadSpeed(){return Object(X["a"])(this.torrent.uploadSpeed,{byte:!1,gb:!1})+"/s"},taskAction(){return this.torrent.paused?this.torrent.done||this.torrent.isSeeding?this.$t("seed"):this.$t("resume"):this.torrent.isSeeding?this.$t("stop_torrent"):this.$t("pause")},actionIcon(){return this.torrent.paused?this.torrent.done||this.torrent.isSeeding?"cloud_upload":"play_arrow":this.torrent.isSeeding?"stop":"pause"},playableFiles(){return this.torrent.files.filter((t=>Object(c["a"])(t.name)))},playable(){return this.playableFiles.length},showAbButton(){var t,e;return null===(t=this.torrent)||void 0===t||null===(e=t.connections)||void 0===e?void 0:e.some((t=>t.isAbPeer&&t.subId&&t.subId!==this.$store.getters.accountUserInfo.sub))},isPayed(){var t,e;return null===(t=this.torrent)||void 0===t||null===(e=t.connections)||void 0===e?void 0:e.some((t=>"high"===t.remoteGroup))}},methods:{shouldShow(t){return this.visibleColumns.includes(t)},onDoubleClick(){this.playable?this.$emit("play",this.playableFiles[0].path,this.torrent.infoHash):this.openFile()},toggleStatus(){this.locked||(this.locked=!0,setTimeout((()=>{this.locked=!1}),500),this.torrent.paused?this.$emit("resumeTorrent",this.torrent):this.$emit("pauseTorrent",this.torrent.infoHash||this.torrent.token))},deleteTorrent(){this.$emit("deleteTorrent",this.torrent)},openFile(){1===this.torrent.files.length?this.io.emit("open-external-file",this.torrent.files[0].path,this.torrent.infoHash):this.showDirectory()},showDirectory(){this.$emit("showDirectory",this.torrent)},showDetail(){this.$emit("showDetail",this.torrent)},openAbPanel(){this.$emit("showAbPanel",this.torrent)}}},Z=K,tt=(s("755b"),s("bd08")),et=s("db86"),st=s("58a81"),ot=Object(g["a"])(Z,Y,V,!1,null,null,null),it=ot.exports;_()(ot,"components",{QTr:tt["a"],QTd:et["a"],QLinearProgress:D["a"],QBadge:st["a"],QBtn:H["a"]});var nt=s("e302"),at={name:"TableList",props:{list:{type:Object,required:!0},tab:{type:String,default:"downloading"},incomes:{type:Object,default:()=>({})},noDataMessage:{type:String,default:()=>""}},components:{ListItem:it},data(){const t=this;let e={name:250,remaining:80,completedTime:80,progress:120,downloadSpeed:150,uploadSpeed:100,incomeInfo:120,options:130};return localStorage.getItem("table-col-width")||localStorage.setItem("table-col-width",JSON.stringify(e)),e=JSON.parse(localStorage.getItem("table-col-width")),{emitEvent:new Proxy({},{get(e,s){return(...e)=>{console.log("emit",s),t.$emit(s,...e)}}}),defaultColumns:{downloading:["name","remaining","progress","downloadSpeed","options"],uploading:["name","completedTime","uploadSpeed","incomeInfo","options"],downloaded:["name","completedTime","options"]},dragData:{start:!1,col:"",pageX:0,pageY:0},colWidth:e}},computed:{columns(){return[{name:"name",required:!0,label:this.$t("task_name"),align:"left",headerStyle:this.colWidthText.name+";padding-left: 48px; max-width: calc(100% - 48px);"},{name:"remaining",label:this.$t("remaining"),align:"left",headerStyle:this.colWidthText.remaining+"; max-width: calc(100% - 8px)"},{name:"completedTime",label:this.$t("completed_time"),align:"left",headerStyle:this.colWidthText.completedTime+"; max-width: calc(100% - 8px)"},{name:"progress",label:this.$t("progress"),align:"left",headerStyle:this.colWidthText.progress+"; max-width: calc(100% - 8px)"},{name:"downloadSpeed",label:this.$t("total_download_speed"),align:"left",headerStyle:this.colWidthText.downloadSpeed+"; max-width: calc(100% - 8px)"},{name:"uploadSpeed",label:this.$t("total_upload_speed"),align:"left",headerStyle:this.colWidthText.uploadSpeed+"; max-width: calc(100% - 8px)"},{name:"incomeInfo",label:this.$t("income_info"),align:"right",headerStyle:this.colWidthText.incomeInfo+"; max-width: calc(100% - 8px)"},{name:"options",label:this.$t("operations"),align:"left"}]},visibleColumns(){switch(this.tab){case"downloading":return this.defaultColumns.downloading;case"uploading":return 2!==this.$store.state.credits.isModuleInit?this.defaultColumns.uploading.filter((t=>"incomeInfo"!==t)):this.defaultColumns.uploading;case"downloaded":return this.defaultColumns.downloaded}return this.defaultColumns.downloading},showCols(){const t={};for(const e of this.visibleColumns)t[e]=!0;return t},colWidthText(){const t={};for(const e in this.colWidth){const s=this.colWidth[e];t[e]=`width: ${s}px; min-width: ${s}px; max-width: ${s}px;`}return t},tableList(){var t,e;return(null===(t=this.list)||void 0===t||null===(e=t.list)||void 0===e?void 0:e.map((t=>({name:t.name}))))||[]},taskIncomes(){const{todayTaskIncome:t,allTaskIncome:e}=this.incomes,s={};for(const o in e)s[o]||(s[o]={today:0,total:0}),s[o].total+=e[o],t[o]&&(s[o].today+=t[o]);return s}},methods:{onDragStart(t,e){this.dragData.pageX=e.pageX,this.dragData.pageY=e.pageY,this.dragData.start=!0,this.dragData.col=t.name,document.body.style.cursor="col-resize"},onDragEnd(){this.dragData.start&&(this.dragData.start=!1,document.body.style.cursor="",localStorage.setItem("table-col-width",JSON.stringify(this.colWidth)))},onDrag(t){if(!this.dragData.start)return;const e=this.dragData.pageX-t.pageX;this.dragData.pageX=t.pageX,this.colWidth[this.dragData.col]&&(this.colWidth[this.dragData.col]-=e,this.colWidth[this.dragData.col]<80&&(this.colWidth[this.dragData.col]=80))}},created(){this.onDrag=Object(nt["a"])(this.onDrag,1e3/60)}},rt=at,lt=(s("b6d3"),s("eaac")),dt=s("357e"),ct=Object(g["a"])(rt,G,J,!1,null,null,null),ht=ct.exports;_()(ct,"components",{QTable:lt["a"],QTr:tt["a"],QTh:dt["a"],QIcon:b["a"]});var pt=s("9b0f"),ut=s.n(pt),mt=s("a32b"),gt=s.n(mt),bt=function(){var t=this,e=this,s=e.$createElement,o=e._self._c||s;return o("q-dialog",{attrs:{value:e.show},on:{input:function(e){return t.$emit("change",e)},"before-hide":function(){return t.disable=!1}}},[o("q-card",{staticClass:"info"},[o("q-card-section",[o("div",{staticClass:"text-h6"},[e._v(e._s(e.$t("create_payment")))]),o("div",{staticClass:"infohash"},[e._v(e._s(e.$t("pay_for_torrent",[e.torrentName])))]),o("small",{staticClass:"infohash text-secondary"},[e._v("infoHash: "+e._s(e.infoHash))]),o("div",{staticClass:"peer-info"},[e._v(e._s(e.$t("pay_target"))+":\n        "),o("div",{staticClass:"q-ml-sm remote"},[e._v("SubId: "+e._s(e.remoteSubId))]),o("div",{staticClass:"peer-address q-ml-md"},[e._v("Address: "+e._s(e.address))]),o("div",{staticClass:"peer-id q-ml-md"},[e._v("PeerId: "+e._s(e.peerId))])]),o("div",{staticClass:"space q-my-md"}),o("div",{staticClass:"user-info"},[o("div",{staticClass:"sub-id"},[e._v(e._s(e.$t("your_subid"))+": "+e._s(e.subId))]),o("div",{staticClass:"credit-count"},[e._v(e._s(e.$t("your_credits"))+": "+e._s(e.credit))])]),o("div",{staticClass:"actions"},[o("q-btn",{attrs:{"no-caps":"",label:e.$t("pay_point_for_data",[2,"20MB"]),disable:e.disable,loading:e.disable},on:{click:function(t){return e.pay(2)}}}),o("q-btn",{attrs:{"no-caps":"",label:e.$t("pay_point_for_data",[10,"100MB"]),disable:e.disable,loading:e.disable},on:{click:function(t){return e.pay(10)}}}),o("br"),o("q-toggle",{attrs:{value:e.enableAutoRenew,label:e.$t("auto_renew"),"left-label":""},on:{input:e.setAutoRenew}})],1)])],1)],1)},ft=[],yt={name:"TorrentPayment",props:{infoHash:{type:String,default:""},torrentName:{type:String,default:""},peerId:{type:String,default:""},address:{type:String,default:""},remoteUser:{type:String,default:""},remoteSubId:{type:String,default:""},show:{type:Boolean,default:!1},autoRenew:{type:Object,default:()=>({})}},inject:["transactions"],data(){return{disable:!1,sentTransactions:new Set,pendingTransactions:new Map}},computed:{credit(){return this.$store.state.credits.credit},userId(){return this.$store.state.account.username},subId(){return this.$store.state.account.sub},enableAutoRenew(){return this.autoRenew&&this.autoRenew[this.infoHash]||!1},income(){var t;return(null===(t=this.transactions)||void 0===t?void 0:t.income)||[]},expenses(){var t;return(null===(t=this.transactions)||void 0===t?void 0:t.expenses)||[]}},methods:{setAutoRenew(t){this.$emit("setAutoRenew",this.infoHash,t)},pay(t=1){if(!this.infoHash.length||!this.peerId.length||!this.remoteSubId.length)return this.$q.notify("Info missing");this.disable=!0,this.$emit("createPayment",{infoHash:this.infoHash,peerId:this.peerId,remoteSubId:this.remoteSubId,payed:t,autoRenew:this.enableAutoRenew})}}},_t=yt,wt=s("9564"),vt=Object(g["a"])(_t,bt,ft,!1,null,null,null),Tt=vt.exports;_()(vt,"components",{QDialog:F["a"],QCard:x["a"],QCardSection:q["a"],QBtn:H["a"],QToggle:wt["a"]});var $t=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.torrent?s("q-dialog",{staticClass:"detail-dialog",attrs:{value:t.show},on:{input:t.closeDialog}},[s("q-card",[s("q-card-section",[s("div",{staticClass:"text-h6 ellipsis"},[t._v(t._s(t.torrent.name))]),s("q-input",{attrs:{readonly:"",label:"Download URI"},scopedSlots:t._u([{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer text-h4",attrs:{name:"content_copy"},on:{click:t.copyMagnetURI}},[s("q-tooltip",[t._v(t._s(t.$t("copy_download_uri")))])],1),s("IconWithTooltip",{attrs:{icon:"share",tooltip:t.$t("copy_share_uri"),clickable:!0},on:{click:t.copyShortURI}})]},proxy:!0}],null,!1,1430967626),model:{value:t.downloadURI,callback:function(e){t.downloadURI=e},expression:"downloadURI"}})],1),t.fileTree.length?s("q-card-section",{staticClass:"q-py-none"},[s("div",{staticClass:"title"},[s("q-btn",{attrs:{flat:"",dense:"",size:"sm"},on:{click:t.showDirectory}},[s("IconWithTooltip",{attrs:{icon:"folder_open",tooltip:t.$t("open_directory"),clickable:""}})],1),t._v("\n        "+t._s(t.$t("files"))+":\n      ")],1),s("q-tree",{staticClass:"no-select file-tree",attrs:{nodes:t.fileTree,"node-key":"label",dense:"","no-connectors":""},scopedSlots:t._u([{key:"default-header",fn:function(e){return[s("q-item",{staticClass:"text full-width q-py-none q-px-xs no-margin vertical-middle",attrs:{dense:"",clickable:!e.node.children},on:{dblclick:function(s){return t.onDblClick(e.node)}}},[e.node.children?s("IconWithTooltip",{staticClass:"q-mt-xs q-mr-xs",attrs:{icon:"folder"}}):s("IconWithTooltip",t._b({staticClass:"q-mt-xs q-mr-xs"},"IconWithTooltip",t.getFileIcon(e.node.path),!1)),t._v("\n            "+t._s(e.node.label)+"\n          ")],1)]}}],null,!1,3651129721)})],1):t._e(),s("q-card-section",{staticClass:"peers"},[s("q-expansion-item",{directives:[{name:"show",rawName:"v-show",value:t.connectedPeers.length,expression:"connectedPeers.length"}],attrs:{"expand-separator":"",icon:"people",label:"Peers"}},t._l(t.connectedPeers,(function(e){return s("PeerInfo",{key:e.id,attrs:{peer:e},on:{showPaymentPannel:t.showPaymentPannel}})})),1)],1)],1)],1):t._e()},St=[],xt=s("cdde"),qt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-field",{staticClass:"q-mx-md q-my-xs",attrs:{"stack-label":"",borderless:"",readonly:"",label:t.peer.subId||t.peer.id},scopedSlots:t._u([{key:"prepend",fn:function(){return[t.peer.isAbPeer?"high"===t.peer.level?s("q-icon",{attrs:{name:"done_all"}},[s("q-tooltip",[t._v(t._s(t.$t("ab_peer_verified")))])],1):s("q-icon",{attrs:{name:"done"}},[s("q-tooltip",[t._v(t._s(t.$t("ab_peer")))])],1):s("q-icon",{attrs:{name:"remove"}},[s("q-tooltip",[t._v(t._s(t.$t("common_peer")))])],1)]},proxy:!0},{key:"control",fn:function(){return[t._l(t.peer.addresses,(function(e){return s("div",{key:t.peer.id+"_"+e,staticClass:"self-center full-width not-outline"},[t._v(t._s(e))])})),s("div",{staticClass:"text full-width q-mt-xs"},[s("span",{staticClass:"peer-speed q-ml-xs",class:{"text-primary":t.peer.uploadSpeed}},[t._v("↑ "+t._s(t.uploadSpeed)+" / s")]),s("span",{staticClass:"peer-speed q-ml-md",class:{"text-primary":t.peer.downloadSpeed}},[t._v("↓ "+t._s(t.downloadSpeed)+" / s")])])]},proxy:!0}])})},kt=[],Ct={props:{peer:{type:Object,required:!0}},computed:{uploadSpeed(){return Object(X["a"])(this.peer.uploadSpeed,{byte:!1,gb:!1})},downloadSpeed(){return Object(X["a"])(this.peer.downloadSpeed,{byte:!1,gb:!1})}},methods:{showPaymentPannel(){this.$emit("showPaymentPannel",{peerId:this.peer.id,address:this.peer.address,remoteUser:this.peer.user,remoteSubId:this.peer.subId})}}},It=Ct,Pt=Object(g["a"])(It,qt,kt,!1,null,null,null),Dt=Pt.exports;_()(Pt,"components",{QField:Q["a"],QIcon:b["a"],QTooltip:f["a"]});var At={props:{show:{type:Boolean,default:!1},torrent:{type:Object,required:!0}},components:{IconWithTooltip:v,PeerInfo:Dt},inject:["io"],computed:{fileTree(){if(!this.torrent||!this.torrent.files)return[];const t=Object(X["b"])(this.torrent.files.map((t=>t.path)));return t?[t]:[]},downloadURI(){return this.torrent.alphabizURI?this.torrent.alphabizURI:this.torrent.magnetURI},connectedPeers(){if(!this.torrent||!this.torrent.connections)return[];const t={};for(const e of this.torrent.connections){const s=e.subId||e.id;t[s]||(t[s]={...e},t[s].addresses=[],t[s].uploadSpeed=0,t[s].downloadSpeed=0,t[s].downloaded=0),t[s].addresses.includes(e.address)||t[s].addresses.push(e.address),t[s].uploadSpeed+=e.uploadSpeed,t[s].downloadSpeed+=e.downloadSpeed,t[s].downloaded+=e.downloaded,t[s].isAbPeer|=e.isAbPeer,t[s].isPayed|="high"===e.remoteGroup}return Object.values(t).sort(((t,e)=>{var s;return null!==(s=t.id)&&void 0!==s&&s.localeCompare?t.id.localeCompare(e.id):0}))}},methods:{getFileIcon(t){const e=Object(X["c"])([t]);return{icon:e.icon,tooltip:this.$t(e.tooltip)}},closeDialog(){this.$emit("close")},copyToClipboard(t){Object(xt["a"])(t).then((()=>{this.$q.notify(this.$t("uri_copied"))})).catch((()=>{this.$q.notify(this.$t("uri_copy_failed"))}))},copyMagnetURI(){this.copyToClipboard(this.downloadURI)},copyShortURI(){if(!this.torrent.alphabizURI)return;const t=this.torrent.alphabizURI.match(/[^:/]\/([^&/]+)&/);t&&t[1]&&this.copyToClipboard("ab://"+t[1])},showPaymentPannel(t){this.$emit("showPaymentPannel",Object.assign({infoHash:this.torrent.infoHash,name:this.torrent.name},t))},showDirectory(){this.$emit("showDirectory",this.torrent)},onDblClick(t){console.log(t),t.children||(Object(c["a"])(t.label)?this.$emit("play",t.label,this.torrent.infoHash):t.path&&this.io.emit("open-external-file",t.path))}}},Ot=At,Ht=(s("9d3e"),s("27f9")),Ft=s("7f41"),Qt=s("3b73"),Lt=Object(g["a"])(Ot,$t,St,!1,null,"ebd22fe8",null),zt=Lt.exports;_()(Lt,"components",{QDialog:F["a"],QCard:x["a"],QCardSection:q["a"],QInput:Ht["a"],QIcon:b["a"],QTooltip:f["a"],QBtn:H["a"],QTree:Ft["a"],QItem:P["a"],QExpansionItem:Qt["a"]});var Rt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-dialog",{attrs:{value:t.showPanel},on:{input:t.close}},[s("q-card",[s("q-card-section",{staticClass:"row items-center"},[s("q-expansion-item",{staticStyle:{width:"400px"},attrs:{"expand-separator":"","default-opened":"",icon:"people",label:"Peers ("+t.abPeers.length+")",caption:"Alphabiz peer"}},[s("div",{staticClass:"total col-12 q-px-md q-ml-sm"},[s("span",[t._v(t._s(t.$t("credit_cost"))+": "+t._s(t.torrentExpensesNum))]),s("br"),s("span",[t._v(t._s(t.$t("downloaded_by_payment"))+": "+t._s(t.downloadedFromPayed))])]),t._l(t.abPeers,(function(e){return s("q-field",{key:e.id,attrs:{label:e.subId||e.id,"stack-label":"",borderless:"",readonly:""},scopedSlots:t._u([{key:"prepend",fn:function(){return[s("div",{staticClass:"q-px-sm"})]},proxy:!0},{key:"control",fn:function(){return[t._l(e.addresses,(function(e,o){return s("div",{key:o+"-"+e,staticClass:"self-center full-width not-outline"},[t._v(" - "+t._s(e))])})),s("div",{staticClass:"text full-width q-mt-xs"},[s("span",{staticClass:"peer-speed q-ml-xs q-mr-lg",class:{"text-primary":"0.00 KB"!==e.uploadSpeed}},[t._v("↑ "+t._s(e.uploadSpeed)+" / s")]),e.isPayed?s("q-icon",{staticClass:"text-primary q-mx-xs cursor-pointer",attrs:{name:"bolt"}},[s("q-tooltip",[t._v(" "+t._s(t.$t("accelerating"))+" ")])],1):t._e(),s("span",{staticClass:"peer-speed q-mr-md",class:{"text-primary":"0.00 KB"!==e.downloadSpeed}},[t._v("↓ "+t._s(e.downloadSpeed)+" / s")]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.downloaded,expression:"peer.downloaded"}],staticClass:"peer-downloaded text-primary"},[t._v(t._s(e.downloadedData))])],1)]},proxy:!0}],null,!0)})}))],2)],1),s("q-card-section",{staticClass:"q-py-none"},[t.hasPayed?s("div",{staticClass:"total text-center"},[t._v("\n        "+t._s(t.$t("pay_with_credit_payed",[t.totalCredits]))+"\n      ")]):s("div",{staticClass:"total text-center"},[t._v("\n        "+t._s(t.$t("pay_with_credit",[t.totalCredits]))+"\n      ")])]),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:t.$t("cancel")}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:t.$t("ok"),color:"primary"},on:{click:t.confirmPayment}})],1)],1)],1)},Nt=[],Et={props:{show:{type:Boolean,required:!0},torrent:{type:Object,required:!0},paymentSize:{type:Number,default:10485760}},computed:{expenses(){return this.$store.getters.transactions.expenses},torrentExpensesNum(){return this.expenses?this.expenses.reduce(((t,e)=>{if(e.meta){const s=JSON.parse(e.meta);if(s.infoHash===this.torrent.infoHash)return t+e.amount}return t}),0):0},showPanel(){return this.show},totalCredits(){const t=this.torrent.length,e=t-this.torrent.downloaded,s=Math.ceil(e/10/1024/1024);return s},abPeers(){if(!this.torrent||!this.torrent.connections)return[];const t=this.torrent.connections.filter((t=>t.isAbPeer&&t.subId!==this.$store.getters.accountUserInfo.sub)),e={};for(const s of t){const t=s.subId;t&&(e[t]?(e[t].isAbPeer|=s.isAbPeer,e[t].addresses.push(s.address),e[t].uploadSpeed+=s.uploadSpeed,e[t].downloadSpeed+=s.downloadSpeed,e[t].downloaded+=s.downloaded):(e[t]={...s},e[t].addresses=[s.address]))}return Object.values(e).sort(((t,e)=>t.id.localeCompare?t.id.localeCompare(e.id):0)).map((t=>(t.uploadSpeed=Object(X["a"])(t.uploadSpeed,{byte:!1,gb:!1}),t.downloadSpeed=Object(X["a"])(t.downloadSpeed,{byte:!1,gb:!1}),t.downloadedData=Object(X["a"])(t.downloaded,{byte:!0,gb:!0}),t.isPayed="high"===t.remoteGroup,t)))},payedConnections(){return this.abPeers.filter((t=>t.isPayed))},downloadedFromPayed(){return Object(X["a"])(this.payedConnections.reduce(((t,e)=>t+e.downloaded||0),0),{byte:!0,gb:!0})},hasPayed(){return this.payedConnections.length}},methods:{confirmPayment(){if(!this.abPeers.length)return;let t=10;const e=Math.floor(10*this.torrent.downloadSpeed/this.paymentSize);e>t&&(t=e);const s=this.torrent.length-this.torrent.downloaded;s<t*this.paymentSize/this.abPeers.length&&(t=Math.ceil(s/this.paymentSize/this.abPeers.length));const o=this.$store.getters.accountUserInfo;if(!o||!o.sub)return this.$q.notify("Please login first");this.$emit("setAutoRenew",this.torrent.infoHash,!0),this.abPeers.forEach((e=>{console.log("pay for",e),e.isPayed?console.log("skip high level peer",e):this.$emit("createPayment",{infoHash:this.torrent.infoHash,remoteSubId:e.subId,payed:t,autoRenew:!0},!0)})),this.close()},close(){this.$emit("close")}}},jt=Et,Ut=s("4b7e"),Wt=Object(g["a"])(jt,Rt,Nt,!1,null,null,null),Mt=Wt.exports;_()(Wt,"components",{QDialog:F["a"],QCard:x["a"],QCardSection:q["a"],QExpansionItem:Qt["a"],QField:Q["a"],QIcon:b["a"],QTooltip:f["a"],QCardActions:Ut["a"],QBtn:H["a"]}),_()(Wt,"directives",{ClosePopup:R["a"]});var Bt=s("2ef0");const Gt=s("ed08").isElectron(),Jt=Gt?s("34bb").clipboard:null;var Yt={name:"Index",inject:["rootApp","io"],components:{CardList:B,TableList:ht,TableListDetail:zt,IconWithTooltip:v,AlphabizPanel:Mt,TorrentPayment:Tt},props:{currentTab:{type:String,default:""}},data(){return{loading:!1,listMode:localStorage.getItem("task-list-mode")||"card",torrentList:{downloading:[],totalDownloadSpeed:0,totalDownloadProgress:0,uploading:[],totalUploadSpeed:0,downloaded:[],all:[]},searchText:"",showSearchText:!1,autoRenew:JSON.parse(localStorage.getItem("task-autorenew")||"{}"),sortOption:"createdTime",sortSequence:1,torrentFile:null,magnetDialog:!1,magnetUrl:"",tab:"magnet",mode:"download",statusText:{},orders:[],info:{downloadSpeed:0,uploadSpeed:0,progress:0,taskNum:0},showPayment:!1,showTorrentDetail:!1,torrentDetailInfoHash:"",paymentData:{infoHash:"",torrentName:"",peerId:"",address:"",remoteUser:"",remoteSubId:""},paymentSize:10485760,showAlphabizPanel:!1,abTorrentInfoHash:"",verified:[],toVerify:[],toFinish:[],started:[]}},computed:{transactions(){return this.$store.getters.transactions},listComponent(){switch(this.listMode){case"list":return"TableList";case"card":return"CardList";default:return"CardList"}},sortOptions(){switch(this.currentTab){case"downloading":return[{label:this.$t("status"),value:"status"},{label:this.$t("task_name"),value:"name"},{label:this.$t("size"),value:"length"},{label:this.$t("total_download_speed"),value:"downloadSpeed"},{label:this.$t("progress"),value:"progress"},{label:this.$t("remaining"),value:"timeRemaining"},{label:this.$t("created_time"),value:"createdTime"},{label:this.$t("used_time"),value:"usedTime"}];case"uploading":return[{label:this.$t("status"),value:"status"},{label:this.$t("task_name"),value:"name"},{label:this.$t("size"),value:"length"},{label:this.$t("total_upload_speed"),value:"uploadSpeed"},{label:this.$t("created_time"),value:"createdTime"},{label:this.$t("completed_time"),value:"completedTime"},{label:this.$t("income"),value:"income"}];case"downloaded":return[{label:this.$t("status"),value:"status"},{label:this.$t("task_name"),value:"name"},{label:this.$t("size"),value:"length"},{label:this.$t("created_time"),value:"createdTime"},{label:this.$t("completed_time"),value:"completedTime"},{label:this.$t("used_time"),value:"usedTime"}]}return[{label:this.$t("status"),value:"status"},{label:this.$t("task_name"),value:"name"}]},settings(){var t;const e=this.$store.state.setting.settings;return{downloadDirectory:e.downloadDirectory,uploadSpeed:e.uploadSpeed,downloadSpeed:e.downloadSpeed,maximumDownloadNum:e.maximumDownloadNum,maximumConnectionsNum:e.maximumConnectionsNum,payedUserShareRadix:e.payedUserShareRadix,trackers:(null===(t=e.trackerBt)||void 0===t?void 0:t.split("\n"))|[],saveLinkSeed:e.saveLinkSeed}},displayTab:{get(){return this.currentTab+"Torrents"},set(t){this.$emit("changeTab",t.replace(/Torrents$/,""))}},displayList(){return[{key:"downloadingTorrents",label:this.$t("downloading"),open:!0,list:this.filterTorrent(this.downloadingTorrents||[])},{key:"uploadingTorrents",label:this.$t("uploading"),open:!1,list:this.filterTorrent(this.uploadingTorrents||[])},{key:"downloadedTorrents",label:this.$t("downloaded"),open:!1,list:this.filterTorrent(this.downloadedTorrents||[])}]},noDataMessage(){return this.searchText?this.$t("no_matched_task"):this.$t("no_task")},downloadingTorrents(){const t=this.sortTorrents(this.torrentList.downloading);return t},disableDownloadAll(){return this.loading||this.downloadingTorrents.every((t=>!t.paused))},disablePauseAllDownloading(){return this.loading||this.downloadingTorrents.every((t=>t.paused))},downloadingProgress(){const t=this.torrentList.totalDownloadProgress;return isNaN(t)||0===t&&0===this.downloadingNum?{value:0,label:this.$t("no_downloading_task")}:{value:t,label:(100*t).toFixed(2)+"%"}},uploadingTorrents(){const t=this.sortTorrents(this.torrentList.uploading);return t},totalDownloadSpeed(){return this.torrentList.totalDownloadSpeed?Object(X["a"])(this.torrentList.totalDownloadSpeed,{byte:!1,gb:!1})+" / s":"0.00 KB / s"},totalUploadSpeed(){if(!this.uploadingTorrents)return"-";const t=this.torrentList.totalUploadSpeed;return Object(X["a"])(t,{byte:!1,gb:!1})+" / s"},downloadedTorrents(){return this.sortTorrents(this.torrentList.downloaded)},torrentItems(){return this.torrentList.all},torrentDetail(){return this.torrentDetailInfoHash&&this.torrentItems.find((t=>t.infoHash===this.torrentDetailInfoHash))||{}},alphabizTorrent(){return this.abTorrentInfoHash&&this.torrentItems.find((t=>t.infoHash===this.abTorrentInfoHash))||{}},downloadingNum(){return this.downloadingTorrents.filter((t=>!t.paused&&!t.pending&&!(!t.download||1===t.progress))).length},incomes(){const t=this.$store.getters.incomeTodayTransactions;let e=0;const s={};t.forEach((t=>{if("PAYDATA"!==t.category||!t.meta||"FINISH"!==t.status)return;e+=t.amount;const o=JSON.parse(t.meta);o.infoHash&&(s[o.infoHash]||(s[o.infoHash]=0),s[o.infoHash]+=t.amount)}));let o=0;const i={};return this.transactions.income.forEach((t=>{if("PAYDATA"!==t.category||!t.meta||"FINISH"!==t.status)return;o+=t.amount;const e=JSON.parse(t.meta);e.infoHash&&(i[e.infoHash]||(i[e.infoHash]=0),i[e.infoHash]+=t.amount)})),{todayIncome:e,todayTaskIncome:s,allIncome:o,allTaskIncome:i}},totalIncomeInfo(){return 2!==this.$store.state.credits.isModuleInit?this.$t("login_to_see_income"):this.$t("total_income_info",[this.incomes.todayIncome,this.incomes.allIncome])}},methods:{setLoading(){this.loading=!0,setTimeout((()=>{this.loading=!1}),2e3)},toggleSearchText(t){this.showSearchText=t,t&&this.$nextTick((()=>{console.log(this.$refs.searchInput),this.$refs.searchInput.focus()}))},pasteSearchText(t){t&&(this.searchText=t.clipboardData.getData("text"))},filterTorrent(t){return t.filter((t=>t.name&&t.name.toLowerCase().includes(this.searchText.toLowerCase())))},clearSearch(){this.searchText="",this.$refs.searchInput.blur()},changeListMode(){"list"===this.listMode?this.listMode="card":this.listMode="list",localStorage.setItem("task-list-mode",this.listMode)},byteToLargerSize(t){if("number"!==typeof t)return"0";if(t<1e3)return t.toFixed(2)+" Byte";const e=(t/1024).toFixed(2);if(e<1e3)return e+" KB";const s=(e/1024).toFixed(2);return s<1e3?s+" MB":(s/1024).toFixed(2)+" GB"},getToken(){var t,e;return"download"===this.mode?"magnet"===this.tab?this.magnetUrl:(null===(t=this.torrentFile)||void 0===t||null===(e=t[0])||void 0===e?void 0:e.path)||Math.random().toString().substr(2):this.torrentFile?this.torrentFile.reduce?this.torrentFile.reduce(((t,e)=>t+(e.path||"")),""):this.torrentFile.path:Math.random().toString().substr(2)},getTorrentListName(t){let e="downloading";return t.isSeeding||t.uploading?e="uploading":t.pending?e="pending":1===t.progress||t.done?e="downloaded":t.paused&&(e="paused"),e},torrentExists(){const t=this.getToken();for(const e of this.torrentItems)if(e.token===t||e.origin===t)return!0;return!1},async clear_select_directory(){await Object(n["a"])("set_setting",this.settings)},async select_directory(){const t=await Object(n["a"])("select_directory");t&&t.filePaths&&(t.filePaths.length>1?this.$q.notify(this.$t("not_length")):(this.settings.downloadDirectory=t.filePaths[0],this.$store.dispatch("set",{downloadDirectory:t.filePaths[0]})))},showMagnetDialog(t){if(Gt&&Jt){const t=Jt.read("public.file-url")||Jt.readText()||"";if(t.startsWith("magnet:?")||t.startsWith("alphabiz")||t.startsWith("ab")){if(t.startsWith("alphabiz://$"))return;this.magnetUrl=t,this.tab="magnet"}else if(t.startsWith("file://")){const e=decodeURI(t.replace("file://","")),s=e.includes("/")?e.substring(e.lastIndexOf("/")):e;this.torrentFile=[{path:e,name:s}],this.tab="torrent"}}this.mode=t,this.magnetDialog=!0},showDetail(t){this.torrentDetailInfoHash=t.infoHash,this.showTorrentDetail=!0},hideDetail(){this.showTorrentDetail=!1,this.torrentDetailInfoHash=""},showAbPanel({infoHash:t}){this.abTorrentInfoHash=t,this.showAlphabizPanel=!0},hideAbPanel(){this.showAlphabizPanel=!1,this.abTorrentInfoHash=""},showOriginTorrent(t){let e=t.token||t.origin;if(t.isSeeding||t.upload?e=t.magnetURI:t.magnetPath&&(e=t.magnetPath),!e)return this.$q.notify("origin_not_found");ut.a.existsSync(e)?this.io.emit("show_torrent_file",e):(e.startsWith("magnum")||(e="magnet:?xt=urn:btih:"+t.infoHash),t.name&&(e+="&dn="+encodeURIComponent(t.name)),Jt.writeText(e),this.$q.notify(this.$t("text_copied")))},showDirectory(t){const e=gt.a.resolve(t.path,t.name);if(!ut.a.existsSync(e))return ut.a.existsSync(t.path)?this.io.emit("show_torrent_file",t.path):this.$q.notify(this.$t("path_missing"));this.io.emit("show_torrent_file",e)},setAutoRenew(t,e){return this.$set(this.autoRenew,t,e)},showPaymentPannel(t){this.paymentData=t,this.showPayment=!0},showSelectFolder(){console.log(this.$refs.folderSelector),this.$refs.folderSelector.click()},selectFolder(t){if(!Gt)return;const e=s("a32b"),o=s=>{if(!s)return null;try{let t=e.dirname(s[0]);for(let o=1;o<s.length;o++)while(!s[o].includes(t)&&t.length>1)t=e.dirname(t);return t}catch(t){return null}},i=o([...t.target.files].map((t=>t.path)));console.log(i),this.torrentFile=[{path:i,name:e.basename(i)}]},submit(){if(""!==this.magnetUrl||this.torrentFile)return this.torrentExists()?this.$q.notify(this.$t("torrent_exists")):void("download"===this.mode?this.downloadTorrent():this.uploadTorrent())},setOrders(t){if(Array.isArray(t))this.orders=t;else if("object"===typeof t){const e=[];for(const[s,o]of Object.entries(t))e[o]=s;for(const t of this.torrentItems)t.infoHash&&!e.includes(t.infoHash)&&e.push(t.infoHash);this.orders=e.flat()}},changeSortSequence(){this.sortSequence*=-1},sortTorrents(t){const e=this.sortOption;if("status"===e)return t.sort(((t,e)=>this.statusSortFn(t,e)*this.sortSequence));const s=e;switch(s){case"length":case"downloadSpeed":case"downloaded":case"uploadSpeed":case"uploaded":case"timeRemaining":case"progress":case"usedTime":return t.sort(((t,e)=>"number"!==typeof t[s]?"number"!==typeof e[s]?0:1:"number"!==typeof e[s]?-1:(t[s]-e[s])*this.sortSequence));case"createdTime":case"completedTime":return t.sort(((t,e)=>"number"!==typeof t[s]?"number"!==typeof e[s]?0:-1:"number"!==typeof e[s]?1:-(t[s]-e[s])*this.sortSequence));case"name":return t.sort(((t,e)=>t[s].localeCompare(e[s])*this.sortSequence));case"income":{const e=this.incomes.allTaskIncome;return t.sort(((t,s)=>e[t.infoHash]?e[s.infoHash]?(e[t.infoHash]-e[s.infoHash])*this.sortSequence:-1:e[s.infoHash]?1:0))}default:return t}},statusSortFn(t,e){return t.done?e.done?0:1:e.done?-1:t.paused?e.paused?0:1:e.paused?-1:t.pending?e.paused?-1:e.pending?0:1:e.pending?-1:0},downloadTorrent(){this.setLoading(),console.log("GetToken:",this.getToken());const t=this.torrentFile&&(this.torrentFile.path||this.torrentFile[0].path),e=this.magnetUrl.replace(/^ab:\/\//g,"alphabiz:///");this.io.emit("download_torrent",{type:this.tab,url:e,file:t,token:this.getToken(),...this.settings}),this.magnetDialog=!1,this.magnetUrl=""},uploadTorrent(){this.setLoading(),console.log("Upload torrent",this.torrentFile),console.log(this.torrentFile.path);const t=this.torrentFile.path?[this.torrentFile.path]:this.torrentFile.map((t=>t.path));this.io.emit("seed_torrent",{file:t,token:this.getToken(),...this.settings}),this.magnetDialog=!1},downloadAll(){this.setLoading();for(const t of this.downloadingTorrents.sort(((t,e)=>t.createdTime-e.createdTime||0)))t.paused&&this.io.emit("resume_torrent",t)},pauseAllDownloading(){this.setLoading(),console.log("pauseall"),this.io.emit("pause_all")},removeAllDownloading(){this.$q.dialog({title:this.$t("delete_task"),message:this.$t("remove_all_downloading_tasks"),options:{type:"checkbox",model:[],items:[{label:this.$t("also_delete_files"),value:"deleteFiles"}]},ok:{textColor:"red",color:"unset",flat:!0,label:this.$t("remove_all")},cancel:this.$t("not_now")}).onOk((t=>{this.setLoading();const e=t.includes("deleteFiles");for(const s of this.downloadingTorrents)this.io.emit("delete_torrent",s.infoHash,e)}))},pauseAllUploading(){this.setLoading();for(const t of this.uploadingTorrents)t.isAutoUpload||this.io.emit("pause_torrent",t.infoHash||t.token)},removeAllUploading(){this.$q.dialog({title:this.$t("delete_task"),message:this.$t("remove_all_upload_tasks"),options:{type:"checkbox",model:[],items:[{label:this.$t("also_delete_files"),value:"deleteFiles"},{label:this.$t("remove_autoupload_files"),value:"deleteAutoUpload"}]},ok:{textColor:"red",color:"unset",flat:!0,label:this.$t("remove_all")},cancel:this.$t("not_now")}).onOk((t=>{this.setLoading();const e=t.includes("deleteFiles"),s=t.includes("deleteAutoUpload");for(const o of this.uploadingTorrents)o.isAutoUpload?s&&this.io.emit("delete_torrent",o.infoHash,!0):this.io.emit("delete_torrent",o.infoHash,e)}))},uploadAll(){console.log("upload all"),this.setLoading();for(const t of this.downloadedTorrents)this.io.emit("resume_torrent",t)},pauseTorrent(t){this.setLoading(),this.statusText[t]=void 0,this.io.emit("pause_torrent",t)},resumeTorrent(t){t&&(this.setLoading(),console.log("resume",t),this.io.emit("resume_torrent",t))},deleteTorrent(t){return console.log("to del",t),t.isAutoUpload?this.$q.dialog({title:this.$t("warning"),message:this.$t("delete_autoupload_confirm"),ok:{textColor:"red",color:"unset",flat:!0,label:this.$t("delete_anyway")},cancel:this.$t("not_now")}).onOk((()=>{this.setLoading(),console.log("Delete autoupload file",t),this.io.emit("delete_torrent",t.infoHash,!0)})):t.missAllFile?(this.setLoading(),this.io.emit("delete_torrent",t.infoHash,!0)):void this.$q.dialog({title:this.$t("delete_task"),message:this.$t("delete_confirm_message"),options:{type:"checkbox",model:[],items:[{label:this.$t("also_delete_files"),value:"deleteFiles"}]},ok:{textColor:"red",color:"unset",flat:!0,label:this.$t("delete")},cancel:this.$t("not_now")}).onOk((e=>{console.log(e.includes("deleteFiles"),"deleteFiles"),this.setLoading(),this.io.emit("delete_torrent",t.infoHash,e.includes("deleteFiles"))}))},clearAll(){this.$q.dialog({title:this.$t("clear_history"),message:this.$t("remove_all_history"),ok:this.$t("remove_all"),cancel:this.$t("not_now")}).onOk((()=>{this.setLoading();for(const t of this.downloadedTorrents)this.io.emit("delete_torrent",t.infoHash)}))},onPaste(t){if(t.preventDefault(),!Gt)return;const e=Jt.read("public.file-url")||Jt.readText();if(e.startsWith("file://")){const t=decodeURI(e.replace("file://","")),s=t.includes("/")?t.substring(t.lastIndexOf("/")):t;if(e.endsWith(".torrent"))return this.torrentFile=[{path:t,name:s}],this.magnetUrl="",this.mode="download",this.tab="torrent",void(this.magnetDialog=!0);const o=[t],i=o.map((t=>`<pre>${t}</pre>`)).join("<br/>");this.$q.dialog({html:!0,title:this.$t("upload"),message:this.$t("ask_if_upload_file")+"<br/>"+i,ok:this.$t("upload"),cancel:this.$t("cancel")}).onOk((()=>{this.setLoading(),this.io.emit("seed_torrent",{file:o,token:"",settings:{...this.settings}})}))}else if(e.startsWith("magnet")||e.startsWith("alphabiz")||e.startsWith("ab")){if(e.startsWith("alphabiz://$"))return;this.magnetUrl=e,this.torrentFile=null,this.mode="download",this.tab="magnet",this.magnetDialog=!0}},paymentCreated(t){this.io.emit("credit_payment_created",t),this.started.push(t.id)},restartPayment(t){this.io.emit("restart_payment",t)},async createPayment(t,e=!1){console.log("Create payment",t,e);const{infoHash:s,remoteSubId:o,payed:i}=t,n=Date.now().toString();this.$store.dispatch("CREDIT_PAY_DATA_REQUEST",{receiverSub:o,amount:i,meta:{infoHash:s,timestamp:n}}).then((s=>{this.paymentCreated({...t,id:s.id}),e||this.$q.notify(this.$t("success"))})).catch((t=>{e||this.$q.notify(t.message||t)})).finally((()=>{e||(this.showPayment=!1)}))},setThrottleGroup(t){this.io.emit("set_throttle_group",t)},saveTorrentFile(t){this.io.emit("save_torrent_file",t)},play(t,e){Gt&&(this.$store.dispatch("remotePlay",e),this.io.emit("play-torrent",{infoHash:e,filepath:t}),this.$router.push("/player"))}},created(){this.io.clear(),this.io.on("client_info",(t=>{this.info=t})),this.io.on("torrent_metadata",(t=>{this.settings.saveLinkSeed&&this.saveTorrentFile(t);for(const e of this.transactions.expenses)if(e.meta&&!this.started.includes(e.id)&&"PENDING"===e.status){const s=JSON.parse(e.meta);s.infoHash===t&&(console.log("restart transaction",e),this.restartPayment({infoHash:t,remoteSubId:e.payeeId,payed:e.amount,autoRenew:this.autoRenew[t],id:e.id}),this.started.push(e.id))}})),this.io.on("torrent_download",(t=>{t.infoHash&&(this.statusText[t.infoHash]=void 0)})),this.io.on("torrent_delete",(t=>{if(console.log("deleted",t),"/"===this.$router.currentRoute.path)for(const e in this.torrentList){const s=this.torrentList[e];if(!Array.isArray(s))continue;const o=s.findIndex((e=>[e.infoHash,e.token,e.origin].includes(t)));-1!==o&&s.splice(o,1)}})),this.io.on("torrent_error",(({token:t,message:e})=>{"/"===this.$router.currentRoute.path&&this.$q.notify({message:this.$t("torrent_error"),caption:e})})),this.io.on("torrent_seed_error",((t,e)=>{t.missFile&&(console.log(t,e),this.$q.dialog({title:this.$t("miss_file"),message:this.$t("delete_miss_file_task",[t.name]),ok:this.$t("delete_task"),cancel:this.$t("cancel")}).onOk((()=>{this.io.emit("delete_torrent",t.infoHash)})))})),this.io.on("client_error",(t=>{this.$q.notify({message:t})})),this.io.on("torrent_list",((t,e)=>{e&&(this.orders=e);let s=0;for(const o of Object.keys(t))Array.isArray(t[o])?setTimeout((()=>{Object(Bt["isEqual"])(this.torrentList[o],t[o])||(this.torrentList[o]=t[o])}),100*s++):this.torrentList[o]=t[o];this.$emit("updateTaskNum",{downloading:this.downloadingTorrents.length,uploading:this.uploadingTorrents.length,downloaded:this.downloadedTorrents.length})})),this.io.on("autoupload-start",(()=>{this.$emit("updateLoadingStatus",{uploading:!0})})),this.io.on("autoupload-complete",(()=>{this.$emit("updateLoadingStatus",{uploading:!1})})),this.io.on("torrent_exists",(()=>this.$q.notify(this.$t("torrent_exists")))),this.io.on("torrent_nopeers",(t=>{t.infoHash&&(this.statusText[t.infoHash]=this.$t("no_peers",[10]))})),this.io.on("torrent_peers",(t=>{t.infoHash&&(this.statusText[t.infoHash]=void 0)})),this.io.on("stop-server",(()=>{this.$store.dispatch("resetRemotePlay"),this.$store.state.video.currentVideo.shouldReset=!0})),this.io.on("request_renew",(t=>{const{subId:e,infoHash:s,peerId:o}=t;if(!this.autoRenew[s])return;const i=this.torrentItems.find((t=>t.infoHash===s));if(!i||i.paused||i.done)return;const n=i.length-i.recieved;let a=10;n<10*this.paymentSize&&(a=Math.ceil(n/this.paymentSize)),this.createPayment({infoHash:s,peerId:o,remoteSubId:e,payed:a,autoRenew:!0},!0)})),this.io.on("verify_payment",(t=>{this.verified.includes(t.id)||(this.transactions.income.some((e=>e.id===t.id&&e.amount===t.payed&&"FAILED"!==e.status))?(this.io.emit("payment_verified",t),this.verified.push(t.id)):(console.log("Unverified payment",t),this.toVerify.push(t)))})),this.io.on("payment_completed",(t=>{console.log("Completed",t),this.$store.dispatch("CREDIT_PAY_DATA_COMPLETED",t).then((()=>{this.io.emit("finish_payment",t)})).catch((()=>{}))})),this.io.on("payment_finished",(t=>{console.log("Finished",t.id);for(const e of this.transactions.expenses)if(e.id===t.id){"COMPLETED"===e.status?this.$store.dispatch("CREDIT_PAY_DATA_FINISH",{transactionId:t.id}):this.toFinish.push(t.id);break}}))},mounted(){this.io.emit("torrent_order"),this.io.emit("torrent_list")},watch:{autoRenew(t){localStorage.setItem("task-autorenew",JSON.stringify(t))},currentTab(t,e){t!==e&&(this.sortOption="createdTime")},magnetDialog(t){!1===t&&(this.torrentFile=null,this.magnetUrl="")},"$store.state.account.sub"(t){const e={user:this.$store.state.account.nickname,sub:t};this.io.emit("set_user",e)},"transactions.expenses"(t,e){Object(Bt["isEqual"])(t,e)||Array.isArray(t)&&t.forEach((t=>{if(t.meta)if("COMPLETED"===t.status)this.toFinish.includes(t.id)&&(this.$store.dispatch("CREDIT_PAY_DATA_FINISH",{transactionId:t.id}),this.toFinish.splice(this.toFinish.indexOf(t.id),1));else if("PENDING"===t.status){if(this.started.includes(t.id))return;const e=JSON.parse(t.meta);console.log("restart transaction",t),this.restartPayment({infoHash:e.infoHash,remoteSubId:t.payeeId,payed:t.amount,autoRenew:!!this.autoRenew[e.infoHash],id:t.id}),this.started.push(t.id)}}))},"transactions.income"(t,e){Object(Bt["isEqual"])(t,e)||Array.isArray(t)&&t.forEach((t=>{if(t.meta)for(let e=0;e<this.toVerify.length;e++){const s=this.toVerify[e];s.id===t.id&&"PENDING"===t.status&&(console.log("Verified income payment"),this.io.emit("payment_verified",s),this.toVerify.splice(e--,1))}}))},"downloadingTorrents.length"(t,e){this.$store.getters.getSettings.autoJumpToDownload&&t>e&&(this.displayTab="downloadingTorrents")}}},Vt=Yt,Xt=(s("7255"),s("3e63"),s("9989")),Kt=s("de5e"),Zt=s("e359"),te=s("65c6"),ee=s("ddd8"),se=s("adad"),oe=s("823b"),ie=s("429b"),ne=s("7460"),ae=s("7d53"),re=Object(g["a"])(Vt,o,i,!1,null,"4c4f104a",null);e["default"]=re.exports;_()(re,"components",{QPage:Xt["a"],QPageSticky:Kt["a"],QHeader:Zt["a"],QToolbar:te["a"],QSpace:O["a"],QBtn:H["a"],QInput:Ht["a"],QIcon:b["a"],QTooltip:f["a"],QSelect:ee["a"],QLinearProgress:D["a"],QBadge:st["a"],QTabPanels:se["a"],QTabPanel:oe["a"],QDialog:F["a"],QCard:x["a"],QCardSection:q["a"],QTabs:ie["a"],QTab:ne["a"],QFile:ae["a"],QCardActions:Ut["a"],QField:Q["a"]}),_()(re,"directives",{ClosePopup:R["a"]})},9242:function(t,e,s){},"9d3e":function(t,e,s){"use strict";s("cc78d")},"9f74":function(t,e,s){"use strict";s("5930")},b6d3:function(t,e,s){"use strict";s("064b")},cc78d:function(t,e,s){},e0f6:function(t,e,s){}}]);